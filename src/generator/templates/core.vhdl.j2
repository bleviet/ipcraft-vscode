{# VHDL Core Module Template #}
{# Generates bus-agnostic core logic with record-based register interface #}
--------------------------------------------------------------------------------
-- Entity: {{ entity_name }}_core
-- Description: Core logic module (bus-agnostic)
-- Generated by ipcore_lib VHDL Generator
--------------------------------------------------------------------------------

library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

use work.{{ entity_name }}_pkg.all;

entity {{ entity_name }}_core is
{% if generics %}
  generic (
{% for generic in generics %}
    {{ generic.name }} : {{ generic.type }}{{ " := " ~ generic.default_value if generic.default_value is not none else "" }}{{ ";" if not loop.last else "" }}
{% endfor %}
  );
{% endif %}
  port (
    -- Clock and reset
    clk : in std_logic;
    rst : in std_logic;

    -- Register interface (record-based)
    regs_in : in t_regs_sw2hw; -- SW-writable registers (from bus wrapper)
    regs_out : out t_regs_hw2sw{{ ";" if secondary_bus_ports or user_ports else "" }} -- HW-writable registers (to bus wrapper)
{% if secondary_bus_ports %}

    -- Secondary Bus Interfaces
{% for port in secondary_bus_ports %}
    {{ "%-14s"|format(port.name) }} : {{ "%-3s"|format(port.direction) }} {{ port.type }}{{ ";" if not loop.last or user_ports else "" }}
{% endfor %}
{% endif %}
{% if user_ports %}

    -- User ports
{% for port in user_ports %}
    {{ port.name }} : {{ port.direction }} {{ port.type }}{{ ";" if not loop.last else "" }}
{% endfor %}
{% endif %}
    );
end entity {{ entity_name }}_core;

architecture rtl of {{ entity_name }}_core is

  ----------------------------------------------------------------------------
  -- Internal Signals
  ----------------------------------------------------------------------------
  -- Add your internal signals here

begin

  ----------------------------------------------------------------------------
  -- Main Process
  ----------------------------------------------------------------------------
  p_main : process(clk)
  begin
    if rising_edge(clk) then
      if rst = '1' then
        -- Reset logic
        regs_out <= C_REGS_HW2SW_RESET;
      else
        -- Example: Access SW-writable register fields
        -- if regs_in.control.enable = '1' then
        --     -- Do something
        -- end if;

        -- Example: Update HW-writable register fields
        -- regs_out.status.busy <= '1';
        null;
      end if;
    end if;
  end process;

end architecture rtl;
