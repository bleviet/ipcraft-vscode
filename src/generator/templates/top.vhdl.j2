{# VHDL Top-Level Template #}
{# Generates top-level entity that instantiates core and bus wrapper #}
--------------------------------------------------------------------------------
-- Entity: {{ entity_name }}
-- Description: Top-level IP core (instantiates core + bus wrapper)
-- Generated by ipcore_lib VHDL Generator
--------------------------------------------------------------------------------

library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

use work.{{ entity_name }}_pkg.all;

entity {{ entity_name }} is
{% if generics %}
  generic (
{% for generic in generics %}
    {{ generic.name }} : {{ generic.type }}{{ " := " ~ generic.default_value if generic.default_value is not none else "" }}{{ ";" if not loop.last else "" }}
{% endfor %}
  );
{% endif %}
  port (
    -- Clock and reset
    {{ clock_port }} : in std_logic;
    {{ reset_port }} : in std_logic;

{% if bus_ports %}
    -- {{ bus_type|upper }} Bus Interface
{% for port in bus_ports %}
    {{ "%-14s"|format(port.name) }} : {{ "%-3s"|format(port.direction) }} {{ port.type }}{{ ";" if not loop.last or secondary_bus_ports or user_ports else "" }}
{% endfor %}
{% endif %}
{% if secondary_bus_ports %}

    -- Secondary Bus Interfaces
{% for port in secondary_bus_ports %}
    {{ "%-14s"|format(port.name) }} : {{ "%-3s"|format(port.direction) }} {{ port.type }}{{ ";" if not loop.last or user_ports else "" }}
{% endfor %}
{% endif %}
{% if user_ports %}

    -- User ports
{% for port in user_ports %}
    {{ port.name }} : {{ port.direction }} {{ port.type }}{{ ";" if not loop.last else "" }}
{% endfor %}
{% endif %}
    );
end entity {{ entity_name }};

architecture rtl of {{ entity_name }} is

{% if registers %}
    -- Internal register signals
  signal regs_sw2hw : t_regs_sw2hw;
  signal regs_hw2sw : t_regs_hw2sw;
{% endif %}

begin

    ----------------------------------------------------------------------------
    -- Bus Wrapper Instance
    ----------------------------------------------------------------------------
    u_{{ bus_type }} : entity work.{{ entity_name }}_{{ bus_type }}
    port map (
      clk => {{ clock_port }},
      rst => {% if reset_active_high %}{{ reset_port }}{% else %}not {{ reset_port }}{% endif %},

{% if bus_ports %}
{% for port in bus_ports %}
      {{ "%-14s"|format(port.name) }} => {{ port.name }},
{% endfor %}
{% endif %}
      regs_out => regs_sw2hw,
      regs_in => regs_hw2sw
    );

    ----------------------------------------------------------------------------
    -- Core Logic Instance
    ----------------------------------------------------------------------------
    u_core : entity work.{{ entity_name }}_core
{% if generics %}
    generic map (
{% for generic in generics %}
      {{ generic.name }} => {{ generic.name }}{{ "," if not loop.last else "" }}
{% endfor %}
    )
{% endif %}
    port map (
      clk => {{ clock_port }},
      rst => {% if reset_active_high %}{{ reset_port }}{% else %}not {{ reset_port }}{% endif %},
      regs_in => regs_sw2hw,
      regs_out => regs_hw2sw{{ "," if secondary_bus_ports or user_ports else "" }}
{% if secondary_bus_ports %}
{% for port in secondary_bus_ports %}
      {{ "%-14s"|format(port.name) }} => {{ port.name }}{{ "," if not loop.last or user_ports else "" }}
{% endfor %}
{% endif %}
{% if user_ports %}
{% for port in user_ports %}
      {{ port.name }} => {{ port.name }}{{ "," if not loop.last else "" }}
{% endfor %}
{% endif %}
    );

end architecture rtl;
