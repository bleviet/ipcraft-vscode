[{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/commands/FileCreationCommands.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/commands/GenerateCommands.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[927,930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[927,930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[937,940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[937,940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/extension.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[699,702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[699,702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[709,712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[709,712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as vscode from \"vscode\";\nimport { Logger, LogLevel } from \"./utils/Logger\";\nimport { MemoryMapEditorProvider } from \"./providers/MemoryMapEditorProvider\";\nimport { IpCoreEditorProvider } from \"./providers/IpCoreEditorProvider\";\nimport {\n  createIpCoreCommand,\n  createMemoryMapCommand,\n  createIpCoreWithMemoryMapCommand,\n} from \"./commands/FileCreationCommands\";\nimport { registerGeneratorCommands } from \"./commands/GenerateCommands\";\n\n/**\n * Register a command, ignoring \"already exists\" errors that occur when the\n * extension host restarts without a full deactivation cycle.\n */\nfunction safeRegisterCommand(\n  context: vscode.ExtensionContext,\n  command: string,\n  handler: (...args: any[]) => any,\n): void {\n  try {\n    context.subscriptions.push(\n      vscode.commands.registerCommand(command, handler),\n    );\n  } catch {\n    // Command was already registered by a previous (stale) activation\n  }\n}\n\n/**\n * Extension activation entry point\n */\nexport function activate(context: vscode.ExtensionContext): void {\n  // Initialize logging\n  Logger.initialize(\"FPGA Memory Map & IP Core Editor\", LogLevel.INFO);\n  const logger = new Logger(\"Extension\");\n  logger.info(\"Extension activating\");\n\n  // Register Memory Map custom editor provider\n  try {\n    context.subscriptions.push(\n      vscode.window.registerCustomEditorProvider(\n        \"fpgaMemoryMap.editor\",\n        new MemoryMapEditorProvider(context),\n        {\n          webviewOptions: {\n            retainContextWhenHidden: true,\n          },\n          supportsMultipleEditorsPerDocument: false,\n        },\n      ),\n    );\n    logger.info(\"Memory Map editor registered\");\n  } catch (e) {\n    logger.warn(\"fpgaMemoryMap.editor already registered – skipping\");\n  }\n\n  // Register IP Core custom editor provider\n  try {\n    context.subscriptions.push(\n      vscode.window.registerCustomEditorProvider(\n        \"fpgaIpCore.editor\",\n        new IpCoreEditorProvider(context),\n        {\n          webviewOptions: {\n            retainContextWhenHidden: true,\n          },\n          supportsMultipleEditorsPerDocument: false,\n        },\n      ),\n    );\n    logger.info(\"IP Core editor registered\");\n  } catch (e) {\n    logger.warn(\"fpgaIpCore.editor already registered – skipping\");\n  }\n\n  // Register File Creation Commands\n  safeRegisterCommand(context, \"fpga-ip-core.createIpCore\", createIpCoreCommand);\n  safeRegisterCommand(context, \"fpga-ip-core.createMemoryMap\", createMemoryMapCommand);\n  safeRegisterCommand(context, \"fpga-ip-core.createIpCoreWithMemoryMap\", createIpCoreWithMemoryMapCommand);\n\n  // Register VHDL Generator Commands\n  registerGeneratorCommands(context);\n  logger.info(\"Generator commands registered\");\n\n  logger.info(\"Extension activated successfully\");\n}\n\n/**\n * Extension deactivation cleanup\n */\nexport function deactivate(): void {\n  const logger = new Logger(\"Extension\");\n  logger.info(\"Extension deactivating\");\n  Logger.dispose();\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/generator/IpCoreScaffolder.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":186,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":186,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as yaml from 'js-yaml';\nimport * as vscode from 'vscode';\nimport { Logger } from '../utils/Logger';\nimport { BusLibraryService } from '../services/BusLibraryService';\nimport { TemplateLoader } from './TemplateLoader';\nimport { GenerateOptions, GenerateResult } from './types';\n\ntype BusDefinition = {\n  ports?: Array<{\n    name: string;\n    width?: number;\n    direction?: string;\n    presence?: string;\n  }>;\n};\n\ntype BusDefinitions = Record<string, BusDefinition>;\n\nexport interface VlnvDef {\n  vendor?: string;\n  library?: string;\n  name?: string;\n  version?: string;\n}\n\nexport interface BusInterfaceDef {\n  name?: string;\n  type?: string;\n  mode?: string;\n  physicalPrefix?: string;\n  physical_prefix?: string;\n  useOptionalPorts?: string[];\n  use_optional_ports?: string[];\n  portWidthOverrides?: Record<string, number>;\n  port_width_overrides?: Record<string, number>;\n  associatedClock?: string;\n  associated_clock?: string;\n  associatedReset?: string;\n  associated_reset?: string;\n  array?: {\n    count?: number;\n    indexStart?: number;\n    index_start?: number;\n    namingPattern?: string;\n    naming_pattern?: string;\n    physicalPrefixPattern?: string;\n    physical_prefix_pattern?: string;\n  };\n  ports?: Array<Record<string, unknown>>;\n  [key: string]: unknown;\n}\n\nexport interface IpCoreData {\n  vlnv?: VlnvDef;\n  description?: string;\n  parameters?: Array<{\n    name?: string;\n    value?: number | string;\n    data_type?: string;\n    dataType?: string;\n  }>;\n  ports?: Array<{\n    name?: string;\n    direction?: string;\n    width?: number | string;\n    presence?: string;\n  }>;\n  busInterfaces?: BusInterfaceDef[];\n  bus_interfaces?: BusInterfaceDef[];\n  clocks?: Array<{ name?: string }>;\n  resets?: Array<{ name?: string; polarity?: string }>;\n  memoryMaps?: Record<string, unknown> | Record<string, unknown>[];\n  memory_maps?: Record<string, unknown> | Record<string, unknown>[];\n  [key: string]: unknown;\n}\n\nexport class IpCoreScaffolder {\n  private readonly logger: Logger;\n  private readonly templates: TemplateLoader;\n  private readonly busLibraryService: BusLibraryService;\n  private busDefinitions: BusDefinitions | null = null;\n\n  private static readonly BUS_TYPE_MAP: Record<string, string> = {\n    AXI4L: 'axil',\n    AXI4LITE: 'axil',\n    AXILITE: 'axil',\n    AVALONMM: 'avmm',\n    AVMM: 'avmm',\n    AVALON_MM: 'avmm',\n    'AVALON-MM': 'avmm',\n  };\n\n  constructor(logger: Logger, templates: TemplateLoader, context: vscode.ExtensionContext) {\n    this.logger = logger;\n    this.templates = templates;\n    this.busLibraryService = new BusLibraryService(logger, context);\n  }\n\n  async generateAll(\n    inputPath: string,\n    outputDir: string,\n    options: GenerateOptions = {}\n  ): Promise<GenerateResult> {\n    try {\n      await this.ensureBusDefinitions();\n      const ipCoreData = await this.loadIpCore(inputPath);\n      const busType = this.getBusType(ipCoreData);\n      const context = await this.buildTemplateContext(ipCoreData, busType, inputPath);\n      const includeRegs = options.includeRegs !== false;\n      const includeTestbench = options.includeTestbench === true;\n      const vendor = options.vendor ?? 'both';\n      const includeVhdl = options.includeVhdl !== false;\n\n      const files: Record<string, string> = {};\n      const name = String(ipCoreData?.vlnv?.name ?? 'ip_core').toLowerCase();\n\n      if (includeVhdl) {\n        files[`rtl/${name}_pkg.vhd`] = this.templates.render('package.vhdl.j2', context);\n        files[`rtl/${name}.vhd`] = this.templates.render('top.vhdl.j2', context);\n        files[`rtl/${name}_core.vhd`] = this.templates.render('core.vhdl.j2', context);\n        files[`rtl/${name}_${busType}.vhd`] = this.templates.render(\n          `bus_${busType}.vhdl.j2`,\n          context\n        );\n      }\n\n      if (includeRegs) {\n        files[`rtl/${name}_regs.vhd`] = this.templates.render('register_file.vhdl.j2', context);\n      }\n\n      if (includeTestbench) {\n        files[`tb/${name}_test.py`] = this.templates.render('cocotb_test.py.j2', context);\n        files['tb/Makefile'] = this.templates.render('cocotb_makefile.j2', context);\n      }\n\n      if (vendor === 'intel' || vendor === 'both') {\n        files[`intel/${name}_hw.tcl`] = this.templates.render('intel_hw_tcl.j2', context);\n      }\n\n      if (vendor === 'xilinx' || vendor === 'both') {\n        files['xilinx/component.xml'] = this.templates.render('xilinx_component_xml.j2', context);\n        const versionStr = String(ipCoreData?.vlnv?.version ?? '1.0').replace(/\\./g, '_');\n        files[`xilinx/xgui/${name}_v${versionStr}.tcl`] = this.templates.render(\n          'xilinx_xgui.j2',\n          context\n        );\n      }\n\n      const written: Record<string, string> = {};\n      await Promise.all(\n        Object.entries(files).map(async ([relativePath, content]) => {\n          const fullPath = path.join(outputDir, relativePath);\n          await fs.mkdir(path.dirname(fullPath), { recursive: true });\n          await fs.writeFile(fullPath, content, 'utf8');\n          written[relativePath] = fullPath;\n        })\n      );\n\n      this.logger.info('Generated VHDL files', {\n        count: Object.keys(written).length,\n        busType,\n        outputDir,\n      });\n\n      return {\n        success: true,\n        files: written,\n        count: Object.keys(written).length,\n        busType,\n      };\n    } catch (error) {\n      this.logger.error('VHDL generation failed', error as Error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  private async ensureBusDefinitions(): Promise<void> {\n    if (this.busDefinitions) {\n      return;\n    }\n    const library = await this.busLibraryService.loadDefaultLibrary();\n    this.busDefinitions = (library || {}) as BusDefinitions;\n  }\n\n  private async loadIpCore(inputPath: string): Promise<IpCoreData> {\n    const content = await fs.readFile(inputPath, 'utf8');\n    const parsed = yaml.load(content);\n    if (!parsed || typeof parsed !== 'object') {\n      throw new Error('Invalid IP core YAML');\n    }\n    return parsed as IpCoreData;\n  }\n\n  private getBusType(ipCore: IpCoreData): string {\n    const busInterfaces = ipCore?.busInterfaces ?? ipCore?.bus_interfaces ?? [];\n\n    for (const bus of busInterfaces) {\n      const mode = this.getString(bus?.mode);\n      if (mode === 'slave') {\n        const rawType = this.getString(bus?.type).toUpperCase();\n        return IpCoreScaffolder.BUS_TYPE_MAP[rawType] || 'axil';\n      }\n    }\n\n    return 'axil';\n  }\n\n  private async buildTemplateContext(\n    ipCore: IpCoreData,\n    busType: string,\n    inputPath: string\n  ): Promise<Record<string, unknown>> {\n    const name = String(ipCore?.vlnv?.name ?? 'ip_core').toLowerCase();\n    const registers = await this.prepareRegisters(ipCore, inputPath);\n    const swAccess = new Set(['read-write', 'write-only', 'rw', 'wo']);\n    const hwAccess = new Set(['read-only', 'ro']);\n\n    const swRegisters = registers.filter((reg) => swAccess.has(this.getString(reg.access)));\n    const hwRegisters = registers.filter((reg) => hwAccess.has(this.getString(reg.access)));\n\n    const clocks = ipCore?.clocks ?? [];\n    const resets = ipCore?.resets ?? [];\n    const clockPort = clocks[0]?.name ?? 'clk';\n    const resetPort = resets[0]?.name ?? 'rst';\n    const resetPolarity = this.getString(resets[0]?.polarity ?? 'activeHigh');\n    const resetActiveHigh = resetPolarity.toLowerCase().includes('high');\n\n    const expandedBusInterfaces = this.expandBusInterfaces(ipCore);\n    const busPorts: Array<Record<string, unknown>> = [];\n    const secondaryBusPorts: Array<Record<string, unknown>> = [];\n    let busPrefix = 's_axi';\n\n    if (expandedBusInterfaces.length > 0) {\n      const primary = expandedBusInterfaces[0];\n      busPrefix = this.normalizePrefix(primary.physical_prefix ?? primary.physicalPrefix ?? '');\n\n      expandedBusInterfaces.forEach((iface, index) => {\n        const busTypeKey = this.normalizeBusTypeKey(iface.type ?? '');\n        const activePorts = this.getActiveBusPorts(\n          busTypeKey,\n          iface.use_optional_ports ?? [],\n          iface.physical_prefix ?? '',\n          iface.mode ?? '',\n          iface.port_width_overrides ?? {}\n        );\n        iface.ports = activePorts;\n        if (index === 0) {\n          busPorts.push(...activePorts);\n        } else {\n          secondaryBusPorts.push(...activePorts);\n        }\n      });\n    }\n\n    return {\n      entity_name: name,\n      registers: registers,\n      sw_registers: swRegisters,\n      hw_registers: hwRegisters,\n      generics: this.prepareGenerics(ipCore),\n      user_ports: this.prepareUserPorts(ipCore),\n      bus_type: busType,\n      bus_ports: busPorts,\n      secondary_bus_ports: secondaryBusPorts,\n      expanded_bus_interfaces: expandedBusInterfaces,\n      bus_prefix: expandedBusInterfaces.length > 0 ? busPrefix : 's_axi',\n      data_width: 32,\n      addr_width: 8,\n      reg_width: 4,\n      memory_maps: (await this.resolveMemoryMaps(ipCore, inputPath)) ?? [],\n      clock_port: clockPort,\n      reset_port: resetPort,\n      reset_active_high: resetActiveHigh,\n      memmap_relpath: `../../${name}.mm.yml`,\n      vendor: ipCore?.vlnv?.vendor,\n      library: ipCore?.vlnv?.library,\n      version: ipCore?.vlnv?.version,\n      description: ipCore?.description ?? '',\n      author: ipCore?.vlnv?.vendor,\n      display_name: String(ipCore?.vlnv?.name ?? 'ip_core')\n        .replace(/_/g, ' ')\n        .replace(/\\b\\w/g, (letter) => letter.toUpperCase()),\n    };\n  }\n\n  private prepareGenerics(ipCore: IpCoreData): Array<Record<string, unknown>> {\n    const params = ipCore?.parameters ?? [];\n    return params.map((param) => ({\n      name: param.name,\n      type: this.getString(param.data_type ?? param.dataType),\n      default_value: param.value,\n    }));\n  }\n\n  private prepareUserPorts(ipCore: IpCoreData): Array<Record<string, unknown>> {\n    const params = ipCore?.parameters ?? [];\n    const paramDefaults = new Map<string, number>();\n    params.forEach((param) => {\n      if (param?.name && param?.value !== undefined) {\n        paramDefaults.set(String(param.name), Number(param.value));\n      }\n    });\n\n    const ports = ipCore?.ports ?? [];\n    return ports.map((port) => {\n      const direction = this.getString(port.direction).toLowerCase();\n      const widthValue = port.width ?? 1;\n      const isParameterized = typeof widthValue === 'string';\n      if (isParameterized) {\n        const defaultWidth = (paramDefaults.get(widthValue) ?? 32) - 1;\n        return {\n          name: String(port.name).toLowerCase(),\n          direction,\n          type: `std_logic_vector(${widthValue}-1 downto 0)`,\n          width: null,\n          width_expr: widthValue,\n          is_parameterized: true,\n          default_width: defaultWidth,\n        };\n      }\n\n      const width = Number(widthValue);\n      if (width === 1) {\n        return {\n          name: String(port.name).toLowerCase(),\n          direction,\n          type: 'std_logic',\n          width: 1,\n          width_expr: null,\n          is_parameterized: false,\n          default_width: null,\n        };\n      }\n\n      return {\n        name: String(port.name).toLowerCase(),\n        direction,\n        type: `std_logic_vector(${width - 1} downto 0)`,\n        width,\n        width_expr: null,\n        is_parameterized: false,\n        default_width: null,\n      };\n    });\n  }\n\n  private expandBusInterfaces(ipCore: IpCoreData): BusInterfaceDef[] {\n    const busInterfaces = ipCore?.busInterfaces ?? ipCore?.bus_interfaces ?? [];\n    if (!Array.isArray(busInterfaces)) {\n      return [];\n    }\n\n    const expanded: BusInterfaceDef[] = [];\n    for (const iface of busInterfaces) {\n      const arrayDef = iface?.array;\n      if (arrayDef) {\n        const count = Number(arrayDef.count ?? 1);\n        const start = Number(arrayDef.indexStart ?? arrayDef.index_start ?? 0);\n        for (let i = 0; i < count; i += 1) {\n          const idx = start + i;\n          const namePattern =\n            arrayDef.namingPattern ?? arrayDef.naming_pattern ?? `${String(iface.name)}_{index}`;\n          const prefixPattern =\n            arrayDef.physicalPrefixPattern ??\n            arrayDef.physical_prefix_pattern ??\n            `${String(iface.physicalPrefix ?? iface.physical_prefix ?? 's_axi_')}{index}_`;\n\n          expanded.push({\n            name: String(namePattern).replace('{index}', String(idx)),\n            type: this.getString(iface.type),\n            mode: this.getString(iface.mode).toLowerCase(),\n            physical_prefix: String(prefixPattern).replace('{index}', String(idx)),\n            use_optional_ports: iface.useOptionalPorts ?? iface.use_optional_ports ?? [],\n            port_width_overrides: iface.portWidthOverrides ?? iface.port_width_overrides ?? {},\n            associated_clock: iface.associatedClock ?? iface.associated_clock,\n            associated_reset: iface.associatedReset ?? iface.associated_reset,\n          });\n        }\n      } else {\n        expanded.push({\n          name: iface.name,\n          type: this.getString(iface.type),\n          mode: this.getString(iface.mode).toLowerCase(),\n          physical_prefix: iface.physicalPrefix ?? iface.physical_prefix ?? 's_axi_',\n          use_optional_ports: iface.useOptionalPorts ?? iface.use_optional_ports ?? [],\n          port_width_overrides: iface.portWidthOverrides ?? iface.port_width_overrides ?? {},\n          associated_clock: iface.associatedClock ?? iface.associated_clock,\n          associated_reset: iface.associatedReset ?? iface.associated_reset,\n        });\n      }\n    }\n\n    return expanded;\n  }\n\n  private getActiveBusPorts(\n    busTypeName: string,\n    useOptionalPorts: string[],\n    physicalPrefix: string,\n    mode: string,\n    portWidthOverrides: Record<string, number>\n  ): Array<Record<string, unknown>> {\n    const busDef = this.busDefinitions?.[busTypeName.toUpperCase()] ?? {};\n    const ports = busDef.ports ?? [];\n    const optionalSet = new Set(useOptionalPorts || []);\n    const activePorts: Array<Record<string, unknown>> = [];\n\n    ports.forEach((port) => {\n      const logicalName = port.name;\n      if (['ACLK', 'ARESETn', 'clk', 'reset'].includes(logicalName)) {\n        return;\n      }\n\n      const presence = port.presence ?? 'required';\n      const isRequired = presence === 'required';\n      const isSelected = optionalSet.has(logicalName);\n      if (!isRequired && !isSelected) {\n        return;\n      }\n\n      let direction = port.direction ?? 'in';\n      if (mode === 'slave') {\n        direction = direction === 'out' ? 'in' : direction === 'in' ? 'out' : direction;\n      }\n\n      let width = port.width ?? 1;\n      if (portWidthOverrides?.[logicalName] !== undefined) {\n        width = portWidthOverrides[logicalName];\n      }\n\n      activePorts.push({\n        logical_name: logicalName,\n        name: `${physicalPrefix}${logicalName.toLowerCase()}`,\n        direction,\n        width,\n        type: this.getVhdlPortType(Number(width), logicalName),\n      });\n    });\n\n    return activePorts;\n  }\n\n  private getVhdlPortType(width: number, logicalName: string): string {\n    if (['AWADDR', 'ARADDR', 'address'].includes(logicalName)) {\n      return 'std_logic_vector(C_ADDR_WIDTH-1 downto 0)';\n    }\n    if (['WDATA', 'RDATA', 'writedata', 'readdata'].includes(logicalName)) {\n      return 'std_logic_vector(C_DATA_WIDTH-1 downto 0)';\n    }\n    if (logicalName === 'WSTRB') {\n      return 'std_logic_vector((C_DATA_WIDTH/8)-1 downto 0)';\n    }\n    if (width === 1) {\n      return 'std_logic';\n    }\n    return `std_logic_vector(${width - 1} downto 0)`;\n  }\n\n  private normalizeBusTypeKey(typeName: string): string {\n    let key = typeName.toUpperCase();\n    if (['AXIL', 'AXI4-LITE', 'AXI4LITE'].includes(key)) {\n      key = 'AXI4L';\n    } else if (['AVMM', 'AVALON-MM'].includes(key)) {\n      key = 'AVALON_MM';\n    } else if (key === 'AXIS') {\n      key = 'AXIS';\n    } else if (key === 'AVALON_ST') {\n      key = 'AVALON_ST';\n    }\n    return key;\n  }\n\n  private normalizePrefix(prefix: string): string {\n    if (!prefix) {\n      return 's_axi';\n    }\n    return prefix.endsWith('_') ? prefix.slice(0, -1) : prefix;\n  }\n\n  private async resolveMemoryMaps(\n    ipCore: IpCoreData,\n    inputPath: string\n  ): Promise<Array<Record<string, unknown>>> {\n    const memoryMaps = ipCore?.memoryMaps ?? ipCore?.memory_maps;\n    if (!memoryMaps) {\n      return [];\n    }\n\n    if (!Array.isArray(memoryMaps) && 'import' in memoryMaps) {\n      const baseDir = path.dirname(inputPath);\n      const importPath = path.resolve(baseDir, memoryMaps.import as string);\n      const content = await fs.readFile(importPath, 'utf8');\n      const parsed = yaml.load(content);\n      if (Array.isArray(parsed)) {\n        return parsed as Array<Record<string, unknown>>;\n      }\n      return parsed ? [parsed as Record<string, unknown>] : [];\n    }\n\n    return Array.isArray(memoryMaps) ? memoryMaps : [memoryMaps];\n  }\n\n  private async prepareRegisters(\n    ipCore: IpCoreData,\n    inputPath: string\n  ): Promise<Array<Record<string, unknown>>> {\n    const memoryMaps = await this.resolveMemoryMaps(ipCore, inputPath);\n    const registers: Array<Record<string, unknown>> = [];\n\n    const processRegister = (reg: Record<string, unknown>, baseOffset: number, prefix: string) => {\n      const currentOffset =\n        baseOffset + this.parseNumber(reg.address_offset ?? reg.addressOffset ?? reg.offset ?? 0);\n      const regName = reg.name || 'REG';\n\n      const nestedRegs = reg.registers || [];\n      if (Array.isArray(nestedRegs) && nestedRegs.length > 0) {\n        const count = Number(reg.count ?? 1) || 1;\n        const stride = Number(reg.stride ?? 0) || 0;\n        for (let i = 0; i < count; i += 1) {\n          const instanceOffset = currentOffset + i * stride;\n          const instancePrefix =\n            count > 1 ? `${prefix}${String(regName)}_${i}_` : `${prefix}${String(regName)}_`;\n          (nestedRegs as Array<Record<string, unknown>>).forEach((child) => {\n            processRegister(child, instanceOffset, instancePrefix);\n          });\n        }\n        return;\n      }\n\n      const fields = ((reg.fields as Array<Record<string, unknown>>) || []).map((field) => {\n        let bitOffset = field.bit_offset ?? field.bitOffset ?? field.bit_range;\n        let bitWidth = field.bit_width ?? field.bitWidth ?? field.bitWidth;\n\n        if (bitOffset === undefined || bitWidth === undefined) {\n          const parsedBits = this.parseBits(this.getString(field.bits));\n          if (bitOffset === undefined) {\n            bitOffset = parsedBits.offset;\n          }\n          if (bitWidth === undefined) {\n            bitWidth = parsedBits.width;\n          }\n        }\n\n        const access = this.getString(field.access || reg.access || 'read-write');\n        const resetValue = field.reset_value ?? field.resetValue ?? field.reset ?? 0;\n\n        return {\n          name: field.name,\n          offset: Number(bitOffset ?? 0),\n          width: Number(bitWidth ?? 1),\n          access: access.toLowerCase(),\n          reset_value: resetValue,\n          description: field.description || '',\n        };\n      });\n\n      const regAccess = this.getString(reg.access || 'read-write');\n      registers.push({\n        name: `${prefix}${String(regName)}`,\n        offset: currentOffset,\n        access: regAccess.toLowerCase(),\n        description: reg.description || '',\n        fields,\n      });\n    };\n\n    memoryMaps.forEach((map) => {\n      const blocks =\n        (map.addressBlocks as Array<Record<string, unknown>>) ||\n        (map.address_blocks as Array<Record<string, unknown>>) ||\n        [];\n      blocks.forEach((block) => {\n        const baseOffset = this.parseNumber(\n          block.base_address ?? block.baseAddress ?? block.offset ?? 0\n        );\n        const regs = (block.registers as Array<Record<string, unknown>>) || [];\n        regs.forEach((reg) => processRegister(reg, baseOffset, ''));\n      });\n    });\n\n    return registers.sort((a, b) => (a.offset as number) - (b.offset as number));\n  }\n\n  private parseBits(bits: string): { offset: number; width: number } {\n    if (!bits || typeof bits !== 'string') {\n      return { offset: 0, width: 1 };\n    }\n    const range = bits.match(/\\[(\\d+):(\\d+)\\]/);\n    if (range) {\n      const high = Number(range[1]);\n      const low = Number(range[2]);\n      return { offset: Math.min(low, high), width: Math.abs(high - low) + 1 };\n    }\n    const single = bits.match(/\\[(\\d+)\\]/);\n    if (single) {\n      const bit = Number(single[1]);\n      return { offset: bit, width: 1 };\n    }\n    return { offset: 0, width: 1 };\n  }\n\n  private parseNumber(value: unknown): number {\n    if (typeof value === 'number' && Number.isFinite(value)) {\n      return value;\n    }\n    if (typeof value === 'string') {\n      const parsed = Number.parseInt(value, 0);\n      return Number.isFinite(parsed) ? parsed : 0;\n    }\n    return 0;\n  }\n\n  private getString(value: unknown): string {\n    if (value === null || value === undefined) {\n      return '';\n    }\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (typeof value === 'object' && value !== null && 'value' in value) {\n      return String((value as Record<string, unknown>).value);\n    }\n    return String(value);\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/generator/TemplateLoader.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any[]` typed value.","line":69,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":83,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any[]` typed value.","line":88,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":88,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as fs from \"fs\";\nimport * as path from \"path\";\nimport * as vscode from \"vscode\";\nimport * as nunjucks from \"nunjucks\";\nimport { Logger } from \"../utils/Logger\";\n\nexport class TemplateLoader {\n  private readonly logger: Logger;\n  private readonly env: nunjucks.Environment;\n  private readonly templatesPath: string;\n\n  constructor(logger: Logger, templatesPath?: string) {\n    this.logger = logger;\n    this.templatesPath = templatesPath ?? TemplateLoader.resolveTemplatesPath();\n\n    this.env = new nunjucks.Environment(\n      new nunjucks.FileSystemLoader(this.templatesPath, { noCache: true }),\n      {\n        autoescape: false,\n        trimBlocks: true,\n        lstripBlocks: true,\n      },\n    );\n\n    this.env.addFilter(\"format\", (format: string, value: unknown) => {\n      if (typeof format !== \"string\") {\n        return String(value ?? \"\");\n      }\n      const match = format.match(/%(-)?(0)?(\\d+)?([sXx])/);\n      if (!match) {\n        return String(value ?? \"\");\n      }\n      const leftAlign = Boolean(match[1]);\n      const zeroPad = Boolean(match[2]);\n      const width = match[3] ? Number.parseInt(match[3], 10) : 0;\n      const type = match[4];\n\n      let rendered = \"\";\n      if (type === \"s\") {\n        rendered = String(value ?? \"\");\n      } else if (type === \"X\" || type === \"x\") {\n        const num = Number(value ?? 0);\n        rendered = Number.isFinite(num) ? Math.trunc(num).toString(16) : \"0\";\n        if (type === \"X\") {\n          rendered = rendered.toUpperCase();\n        }\n      }\n\n      if (width > 0 && rendered.length < width) {\n        const padChar = zeroPad && !leftAlign ? \"0\" : \" \";\n        const padding = padChar.repeat(width - rendered.length);\n        rendered = leftAlign\n          ? `${rendered}${padding}`\n          : `${padding}${rendered}`;\n      }\n\n      return rendered;\n    });\n\n    this.env.addFilter(\n      \"selectattr\",\n      (\n        items: unknown,\n        attribute: string,\n        operator: string,\n        compare: unknown,\n      ) => {\n        const list = Array.isArray(items) ? items : [];\n        return list.filter((item) => {\n          const value =\n            item && typeof item === \"object\"\n              ? (item as Record<string, unknown>)[attribute]\n              : undefined;\n          if (operator === \"equalto\") {\n            return value === compare;\n          }\n          if (operator === \"in\") {\n            return Array.isArray(compare)\n              ? compare.includes(value as never)\n              : false;\n          }\n          return false;\n        });\n      },\n    );\n\n    this.env.addFilter(\"list\", (items: unknown) => {\n      return Array.isArray(items) ? items : [];\n    });\n\n    this.logger.info(`Template loader using ${this.templatesPath}`);\n  }\n\n  static resolveTemplatesPath(): string {\n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n    const candidates = [path.join(__dirname, \"templates\")].filter(\n      Boolean,\n    ) ;\n\n    for (const candidate of candidates) {\n      if (fs.existsSync(candidate)) {\n        return candidate;\n      }\n    }\n\n    return workspaceRoot ? workspaceRoot : process.cwd();\n  }\n\n  getTemplatesPath(): string {\n    return this.templatesPath;\n  }\n\n  render(templateName: string, context: Record<string, unknown>): string {\n    return this.env.render(templateName, context);\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/generator/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/parser/VhdlParser.ts","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":153,"column":11,"nodeType":"LogicalExpression","messageId":"preferOptionalChain","endLine":153,"endColumn":45,"suggestions":[{"messageId":"optionalChainSuggest","fix":{"range":[3962,3996],"text":"!cleaned?.includes(\":\")"},"desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":184,"column":11,"nodeType":"LogicalExpression","messageId":"preferOptionalChain","endLine":184,"endColumn":45,"suggestions":[{"messageId":"optionalChainSuggest","fix":{"range":[4781,4815],"text":"!cleaned?.includes(\":\")"},"desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":363,"column":9,"nodeType":"LogicalExpression","messageId":"preferOptionalChain","endLine":363,"endColumn":38,"suggestions":[{"messageId":"optionalChainSuggest","fix":{"range":[9364,9393],"text":"!selected?.prefix"},"desc":"Change to an optional chain."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as fs from \"fs/promises\";\nimport * as path from \"path\";\nimport * as yaml from \"js-yaml\";\n\nexport interface ParsedPort {\n  name: string;\n  direction: string;\n  type: string;\n  width?: number | string;\n}\n\nexport interface ParsedParameter {\n  name: string;\n  type: string;\n  value?: string;\n}\n\nexport interface ParseOptions {\n  vendor?: string;\n  library?: string;\n  version?: string;\n  detectBus?: boolean;\n}\n\nexport interface ParseResult {\n  entityName: string;\n  yamlText: string;\n  outputPath?: string;\n}\n\nexport class VhdlParser {\n  async parseFile(\n    vhdlPath: string,\n    options: ParseOptions = {},\n  ): Promise<ParseResult> {\n    const content = await fs.readFile(vhdlPath, \"utf8\");\n    const cleaned = this.stripComments(content);\n\n    const entityName = this.extractEntityName(cleaned);\n    if (!entityName) {\n      throw new Error(\"No VHDL entity found in file\");\n    }\n\n    const parameters = this.extractParameters(cleaned);\n    const ports = this.extractPorts(cleaned);\n\n    const detectBus = options.detectBus !== false;\n    const busDetection = detectBus ? this.detectBusInterfaces(ports) : null;\n\n    const clockReset = this.classifyClocksResets(ports);\n\n    const excludedNames = new Set<string>();\n    if (busDetection) {\n      busDetection.busPortNames.forEach((name) => excludedNames.add(name));\n    }\n    clockReset.clocks.forEach((clock) => excludedNames.add(clock.name));\n    clockReset.resets.forEach((reset) => excludedNames.add(reset.name));\n\n    const userPorts = ports.filter((port) => !excludedNames.has(port.name));\n\n    const yamlData: Record<string, unknown> = {\n      apiVersion: \"ipcore/v1.0\",\n      vlnv: {\n        vendor: options.vendor ?? \"user\",\n        library: options.library ?? \"ip\",\n        name: entityName,\n        version: options.version ?? \"1.0\",\n      },\n      description: `Generated from ${path.basename(vhdlPath)}`,\n    };\n\n    if (clockReset.clocks.length > 0) {\n      yamlData.clocks = clockReset.clocks.map((clock) => ({\n        name: clock.name,\n        description: \"\",\n      }));\n    }\n\n    if (clockReset.resets.length > 0) {\n      yamlData.resets = clockReset.resets.map((reset) => ({\n        name: reset.name,\n        polarity: reset.polarity,\n        description: \"\",\n      }));\n    }\n\n    if (userPorts.length > 0) {\n      yamlData.ports = userPorts.map((port) => this.portToDict(port));\n    }\n\n    if (busDetection && busDetection.busInterfaces.length > 0) {\n      yamlData.busInterfaces = busDetection.busInterfaces.map((bus) => ({\n        name: bus.name,\n        type: bus.type,\n        mode: bus.mode,\n        physicalPrefix: bus.physicalPrefix,\n        description: \"\",\n      }));\n    }\n\n    if (parameters.length > 0) {\n      yamlData.parameters = parameters.map((param) => ({\n        name: param.name,\n        value: this.parseParameterValue(param.value),\n        dataType: param.type.toLowerCase(),\n      }));\n    }\n\n    yamlData.fileSets = [\n      {\n        name: \"RTL_Sources\",\n        description: \"RTL source files\",\n        files: [{ path: path.basename(vhdlPath), type: \"vhdl\" }],\n      },\n    ];\n\n    const yamlText = yaml.dump(yamlData, {\n      noRefs: true,\n      sortKeys: false,\n      lineWidth: -1,\n      indent: 2,\n    });\n\n    return {\n      entityName,\n      yamlText,\n    };\n  }\n\n  private stripComments(content: string): string {\n    return content\n      .split(\"\\n\")\n      .map((line) => line.replace(/--.*$/, \"\"))\n      .join(\"\\n\");\n  }\n\n  private extractEntityName(content: string): string | null {\n    const match = content.match(/\\bentity\\s+(\\w+)\\s+is\\b/i);\n    return match ? match[1] : null;\n  }\n\n  private extractParameters(content: string): ParsedParameter[] {\n    const body = this.extractBlockContent(content, \"generic\");\n    if (!body) {\n      return [];\n    }\n\n    const entries = this.splitEntries(body);\n    const params: ParsedParameter[] = [];\n\n    for (const entry of entries) {\n      const cleaned = entry.replace(/\\s+/g, \" \").trim();\n      if (!cleaned || !cleaned.includes(\":\")) {\n        continue;\n      }\n      const [namesPart, typePart] = cleaned.split(\":\");\n      const names = namesPart\n        .split(\",\")\n        .map((name) => name.trim())\n        .filter(Boolean);\n      const typeMatch = typePart.split(\":=\");\n      const type = typeMatch[0].trim();\n      const value = typeMatch[1]?.trim();\n\n      names.forEach((name) => {\n        params.push({ name, type, value });\n      });\n    }\n\n    return params;\n  }\n\n  private extractPorts(content: string): ParsedPort[] {\n    const body = this.extractBlockContent(content, \"port\");\n    if (!body) {\n      return [];\n    }\n\n    const entries = this.splitEntries(body);\n    const ports: ParsedPort[] = [];\n\n    for (const entry of entries) {\n      const cleaned = entry.replace(/\\s+/g, \" \").trim();\n      if (!cleaned || !cleaned.includes(\":\")) {\n        continue;\n      }\n      const [namesPart, typePart] = cleaned.split(\":\");\n      const names = namesPart\n        .split(\",\")\n        .map((name) => name.trim())\n        .filter(Boolean);\n      const dirMatch = typePart.trim().match(/^(in|out|inout)\\s+(.+)$/i);\n      if (!dirMatch) {\n        continue;\n      }\n      const direction = dirMatch[1].toLowerCase();\n      const type = dirMatch[2].trim();\n      const width = this.extractWidthFromType(type);\n\n      names.forEach((name) => {\n        ports.push({ name, direction, type, width });\n      });\n    }\n\n    return ports;\n  }\n\n  private extractWidthFromType(type: string): number | string | undefined {\n    if (/\\bstd_logic\\b/i.test(type)) {\n      if (/std_logic_vector/i.test(type)) {\n        const rangeMatch = type.match(/\\(([^)]+)\\)/);\n        if (!rangeMatch) {\n          return undefined;\n        }\n        const range = rangeMatch[1];\n        const numericMatch = range.match(/(\\d+)\\s+downto\\s+(\\d+)/i);\n        if (numericMatch) {\n          const high = Number(numericMatch[1]);\n          const low = Number(numericMatch[2]);\n          return Math.abs(high - low) + 1;\n        }\n\n        const paramMatch = range.match(/(\\w+)\\s*-\\s*1\\s+downto\\s+0/i);\n        if (paramMatch) {\n          return paramMatch[1];\n        }\n      }\n      return 1;\n    }\n\n    return undefined;\n  }\n\n  private portToDict(port: ParsedPort): Record<string, unknown> {\n    let logicalName = port.name.toUpperCase();\n    [\"I_\", \"O_\", \"IO_\"].forEach((prefix) => {\n      if (logicalName.startsWith(prefix)) {\n        logicalName = logicalName.slice(prefix.length);\n      }\n    });\n\n    const result: Record<string, unknown> = {\n      name: port.name,\n      logicalName,\n      direction: port.direction,\n    };\n\n    if (port.width !== undefined) {\n      if (typeof port.width === \"number\") {\n        if (port.width > 1) {\n          result.width = port.width;\n        }\n      } else {\n        result.width = port.width;\n      }\n    }\n\n    return result;\n  }\n\n  private parseParameterValue(value?: string): unknown {\n    if (value === undefined) {\n      return undefined;\n    }\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return undefined;\n    }\n    const numeric = Number(trimmed);\n    if (Number.isFinite(numeric)) {\n      return numeric;\n    }\n    return trimmed;\n  }\n\n  private classifyClocksResets(ports: ParsedPort[]): {\n    clocks: Array<{ name: string }>;\n    resets: Array<{ name: string; polarity: string }>;\n  } {\n    const clocks: Array<{ name: string }> = [];\n    const resets: Array<{ name: string; polarity: string }> = [];\n\n    ports.forEach((port) => {\n      const name = port.name.toLowerCase();\n      if (port.direction !== \"in\") {\n        return;\n      }\n      if (/(^|_)(clk|clock|aclk)$/.test(name)) {\n        clocks.push({ name: port.name });\n        return;\n      }\n      if (/(^|_)(rst|reset|aresetn|reset_n|rst_n)$/.test(name)) {\n        const activeLow =\n          name.endsWith(\"n\") ||\n          name.includes(\"reset_n\") ||\n          name.includes(\"rst_n\");\n        resets.push({\n          name: port.name,\n          polarity: activeLow ? \"activeLow\" : \"activeHigh\",\n        });\n      }\n    });\n\n    return { clocks, resets };\n  }\n\n  private detectBusInterfaces(ports: ParsedPort[]): {\n    busInterfaces: Array<{\n      name: string;\n      type: string;\n      mode: string;\n      physicalPrefix: string;\n    }>;\n    busPortNames: Set<string>;\n  } {\n    const lowerPorts = ports.map((port) => port.name.toLowerCase());\n    const axiSignals = [\n      \"awaddr\",\n      \"awvalid\",\n      \"awready\",\n      \"wdata\",\n      \"wstrb\",\n      \"wvalid\",\n      \"wready\",\n      \"bresp\",\n      \"bvalid\",\n      \"bready\",\n      \"araddr\",\n      \"arvalid\",\n      \"arready\",\n      \"rdata\",\n      \"rresp\",\n      \"rvalid\",\n      \"rready\",\n    ];\n    const avalonSignals = [\"address\", \"read\", \"write\", \"writedata\", \"readdata\"];\n\n    const axiMatch = this.findBestPrefix(lowerPorts, axiSignals);\n    const avalonMatch = this.findBestPrefix(lowerPorts, avalonSignals);\n\n    let selected: {\n      prefix: string;\n      count: number;\n      type: \"AXI4L\" | \"AVALON_MM\";\n    } | null = null;\n\n    if (axiMatch.count >= 4 || avalonMatch.count >= 3) {\n      if (axiMatch.count >= avalonMatch.count) {\n        selected = {\n          prefix: axiMatch.prefix,\n          count: axiMatch.count,\n          type: \"AXI4L\",\n        };\n      } else {\n        selected = {\n          prefix: avalonMatch.prefix,\n          count: avalonMatch.count,\n          type: \"AVALON_MM\",\n        };\n      }\n    }\n\n    if (!selected || !selected.prefix) {\n      return { busInterfaces: [], busPortNames: new Set() };\n    }\n\n    const physicalPrefix = selected.prefix;\n    const busName = physicalPrefix.replace(/_+$/, \"\") || \"bus\";\n    const busPortNames = new Set<string>();\n    ports.forEach((port) => {\n      if (port.name.toLowerCase().startsWith(physicalPrefix)) {\n        busPortNames.add(port.name);\n      }\n    });\n\n    return {\n      busInterfaces: [\n        {\n          name: busName,\n          type: selected.type,\n          mode: \"slave\",\n          physicalPrefix: physicalPrefix,\n        },\n      ],\n      busPortNames,\n    };\n  }\n\n  private findBestPrefix(\n    ports: string[],\n    signals: string[],\n  ): { prefix: string; count: number } {\n    const counts = new Map<string, number>();\n    ports.forEach((name) => {\n      signals.forEach((signal) => {\n        if (name.endsWith(signal)) {\n          const prefix = name.slice(0, name.length - signal.length);\n          counts.set(prefix, (counts.get(prefix) ?? 0) + 1);\n        }\n      });\n    });\n\n    let bestPrefix = \"\";\n    let bestCount = 0;\n    counts.forEach((count, prefix) => {\n      if (count > bestCount) {\n        bestCount = count;\n        bestPrefix = prefix;\n      }\n    });\n\n    return { prefix: bestPrefix, count: bestCount };\n  }\n\n  private extractBlockContent(content: string, keyword: string): string | null {\n    const match = content.match(new RegExp(`\\\\b${keyword}\\\\b`, \"i\"));\n    if (!match || match.index === undefined) {\n      return null;\n    }\n\n    const startIndex = content.indexOf(\"(\", match.index);\n    if (startIndex === -1) {\n      return null;\n    }\n\n    let depth = 0;\n    for (let i = startIndex; i < content.length; i += 1) {\n      const char = content[i];\n      if (char === \"(\") {\n        depth += 1;\n      } else if (char === \")\") {\n        depth -= 1;\n        if (depth === 0) {\n          return content.slice(startIndex + 1, i);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  private splitEntries(body: string): string[] {\n    const entries: string[] = [];\n    let depth = 0;\n    let current = \"\";\n\n    for (let i = 0; i < body.length; i += 1) {\n      const char = body[i];\n      if (char === \"(\") {\n        depth += 1;\n      } else if (char === \")\") {\n        depth = Math.max(0, depth - 1);\n      }\n\n      if (char === \";\" && depth === 0) {\n        const trimmed = current.trim();\n        if (trimmed) {\n          entries.push(trimmed);\n        }\n        current = \"\";\n      } else {\n        current += char;\n      }\n    }\n\n    const trimmed = current.trim();\n    if (trimmed) {\n      entries.push(trimmed);\n    }\n\n    return entries;\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/providers/IpCoreEditorProvider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/providers/MemoryMapEditorProvider.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .type on an `any` value.","line":69,"column":11,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":69,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `WebviewMessage`.","line":74,"column":46,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":74,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as vscode from 'vscode';\nimport { Logger } from '../utils/Logger';\nimport { HtmlGenerator } from '../services/HtmlGenerator';\nimport { MessageHandler } from '../services/MessageHandler';\nimport { YamlValidator } from '../services/YamlValidator';\nimport { DocumentManager } from '../services/DocumentManager';\n\n/**\n * Custom editor provider for FPGA memory map YAML files\n */\nexport class MemoryMapEditorProvider implements vscode.CustomTextEditorProvider {\n  private readonly logger = new Logger('MemoryMapEditorProvider');\n  private readonly htmlGenerator: HtmlGenerator;\n  private readonly messageHandler: MessageHandler;\n  private readonly documentManager: DocumentManager;\n\n  constructor(private readonly context: vscode.ExtensionContext) {\n    this.htmlGenerator = new HtmlGenerator(context);\n    this.documentManager = new DocumentManager();\n    const yamlValidator = new YamlValidator();\n    this.messageHandler = new MessageHandler(yamlValidator, this.documentManager);\n\n    this.logger.info('MemoryMapEditorProvider initialized');\n  }\n\n  /**\n   * Resolve the custom text editor for a document\n   */\n  public resolveCustomTextEditor(\n    document: vscode.TextDocument,\n    webviewPanel: vscode.WebviewPanel,\n    _token: vscode.CancellationToken\n  ): void {\n    this.logger.info('Resolving custom text editor for document', document.uri.toString());\n\n    // Configure webview\n    webviewPanel.webview.options = {\n      enableScripts: true,\n    };\n\n    // Set HTML content\n    webviewPanel.webview.html = this.htmlGenerator.generateHtml(webviewPanel.webview);\n\n    let isReady = false;\n\n    // Send update to webview when ready\n    const updateWebview = () => {\n      if (!isReady) {\n        return;\n      }\n      this.messageHandler.sendUpdate(webviewPanel.webview, document);\n    };\n\n    // Listen for document changes\n    const changeDocumentSubscription = vscode.workspace.onDidChangeTextDocument((e) => {\n      if (e.document.uri.toString() === document.uri.toString()) {\n        updateWebview();\n      }\n    });\n\n    // Clean up subscriptions when webview is disposed\n    webviewPanel.onDidDispose(() => {\n      changeDocumentSubscription.dispose();\n      this.logger.debug('Webview panel disposed');\n    });\n\n    // Handle messages from the webview\n    webviewPanel.webview.onDidReceiveMessage((message) => {\n      if (message.type === 'ready') {\n        isReady = true;\n        updateWebview();\n        return;\n      }\n      void this.messageHandler.handleMessage(message, document);\n    });\n\n    // Queue initial content until webview signals readiness\n    updateWebview();\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/BusLibraryService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[476,479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[476,479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":18,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":18,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":54,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":54,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as path from \"path\";\nimport * as vscode from \"vscode\";\nimport * as yaml from \"js-yaml\";\nimport { Logger } from \"../utils/Logger\";\n\nexport class BusLibraryService {\n  private readonly logger: Logger;\n  private cachedDefaultLibrary: any | null = null;\n  private readonly context: vscode.ExtensionContext;\n\n  constructor(logger: Logger, context: vscode.ExtensionContext) {\n    this.logger = logger;\n    this.context = context;\n  }\n\n  async loadDefaultLibrary(): Promise<any> {\n    if (this.cachedDefaultLibrary) {\n      return this.cachedDefaultLibrary;\n    }\n\n    const builtInPath = path.join(\n      this.context.extensionPath,\n      \"dist\",\n      \"resources\",\n      \"bus_definitions.yml\",\n    );\n\n    // Provide only one path since webpack handles resources\n    const candidates = [builtInPath];\n    let loadedContent: string | null = null;\n    let loadedPath: string | null = null;\n\n    for (const candidate of candidates) {\n      try {\n        const uri = vscode.Uri.file(candidate);\n        const fileData = await vscode.workspace.fs.readFile(uri);\n        loadedContent = Buffer.from(fileData).toString(\"utf8\");\n        loadedPath = candidate;\n        break;\n      } catch (e) {\n        // Check next candidate\n      }\n    }\n\n    if (!loadedContent || !loadedPath) {\n      this.logger.error(\"Default bus library not found in extension resources\");\n      return {};\n    }\n\n    try {\n      const parsed = yaml.load(loadedContent);\n      this.cachedDefaultLibrary = parsed ?? {};\n      this.logger.info(`Loaded default bus library from ${loadedPath}`);\n      return this.cachedDefaultLibrary;\n    } catch (error) {\n      this.logger.error(\n        `Failed to parse default bus library from ${loadedPath}`,\n        error as Error,\n      );\n      return {};\n    }\n  }\n\n  clearCache(): void {\n    this.cachedDefaultLibrary = null;\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/DocumentManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/HtmlGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/ImportResolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/MessageHandler.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":81,"column":52,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":81,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .path on an `any` value.","line":81,"column":52,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":81,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2130,2133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2130,2133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as vscode from 'vscode';\nimport { Logger } from '../utils/Logger';\nimport { YamlValidator } from './YamlValidator';\nimport { DocumentManager } from './DocumentManager';\n\n/**\n * Message types that can be sent from the webview\n */\nexport interface WebviewMessage {\n  type: string;\n  [key: string]: unknown;\n}\n\n/**\n * Update message from webview\n */\nexport interface UpdateMessage extends WebviewMessage {\n  type: 'update';\n  text: string;\n}\n\n/**\n * Command message from webview\n */\nexport interface CommandMessage extends WebviewMessage {\n  type: 'command';\n  command: string;\n}\n\n/**\n * Service responsible for handling messages between extension and webview\n */\nexport class MessageHandler {\n  private readonly logger = new Logger('MessageHandler');\n\n  constructor(\n    private readonly yamlValidator: YamlValidator,\n    private readonly documentManager: DocumentManager\n  ) {}\n\n  /**\n   * Handle a message received from the webview\n   */\n  async handleMessage(message: WebviewMessage, document: vscode.TextDocument): Promise<void> {\n    this.logger.debug('Received message from webview', message.type);\n\n    switch (message.type) {\n      case 'update':\n        await this.handleUpdate(message as UpdateMessage, document);\n        break;\n      case 'command':\n        await this.handleCommand(message as CommandMessage, document);\n        break;\n      default:\n        this.logger.warn('Unknown message type', message.type);\n    }\n  }\n\n  /**\n   * Handle update message from webview\n   */\n  private async handleUpdate(message: UpdateMessage, document: vscode.TextDocument): Promise<void> {\n    await this.documentManager.updateDocument(document, message.text);\n  }\n\n  /**\n   * Handle command message from webview\n   */\n  private async handleCommand(\n    message: CommandMessage,\n    document: vscode.TextDocument\n  ): Promise<void> {\n    switch (message.command) {\n      case 'save':\n        await this.handleSaveCommand(document);\n        break;\n      case 'validate':\n        await this.handleValidateCommand(document);\n        break;\n      case 'openFile':\n        await this.handleOpenFileCommand(document, (message as any).path);\n        break;\n      default:\n        this.logger.warn('Unknown command', message.command);\n    }\n  }\n\n  /**\n   * Handle openFile command\n   */\n  private async handleOpenFileCommand(\n    document: vscode.TextDocument,\n    filePath: string\n  ): Promise<void> {\n    try {\n      // Resolve path relative to current document\n      const currentDir = vscode.Uri.joinPath(document.uri, '..');\n      const targetUri = vscode.Uri.joinPath(currentDir, filePath);\n\n      // Open string paths or relative paths\n      await vscode.commands.executeCommand('vscode.open', targetUri);\n      this.logger.info('Opened file:', targetUri.toString());\n    } catch (e) {\n      this.logger.error('Failed to open file', e as Error);\n      void vscode.window.showErrorMessage(`Failed to open file: ${filePath}`);\n    }\n  }\n\n  /**\n   * Handle save command\n   */\n  private async handleSaveCommand(document: vscode.TextDocument): Promise<void> {\n    await document.save();\n    this.logger.info('Document saved');\n  }\n\n  /**\n   * Handle validate command\n   */\n  private async handleValidateCommand(document: vscode.TextDocument): Promise<void> {\n    const result = this.yamlValidator.validate(document.getText());\n\n    if (result.valid) {\n      await vscode.window.showInformationMessage('YAML parsed successfully.');\n      this.logger.info('YAML validation successful');\n    } else {\n      await vscode.window.showErrorMessage(`YAML parse error: ${result.error ?? 'Unknown error'}`);\n      this.logger.warn('YAML validation failed', result.error);\n    }\n  }\n\n  /**\n   * Send an update message to the webview\n   */\n  sendUpdate(webview: vscode.Webview, document: vscode.TextDocument): void {\n    void webview.postMessage({\n      type: 'update',\n      text: this.documentManager.getText(document),\n      fileName: this.documentManager.getRelativePath(document.uri),\n    });\n    this.logger.debug('Sent update to webview');\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/services/YamlValidator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/__mocks__/vscode.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":22,"column":37,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":22,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .toString on an `any` value.","line":22,"column":37,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":22,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":22,"column":37,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":22,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[642,645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[642,645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Mock VS Code API for testing\n */\n\n// Create persistent mock output channel\nconst mockOutputChannel = {\n  appendLine: jest.fn(),\n  show: jest.fn(),\n  dispose: jest.fn(),\n};\n\nexport const window = {\n  createOutputChannel: jest.fn(() => mockOutputChannel),\n  showErrorMessage: jest.fn(),\n  showWarningMessage: jest.fn(),\n  showInformationMessage: jest.fn(),\n};\n\nexport const workspace = {\n  onDidChangeTextDocument: jest.fn(),\n  applyEdit: jest.fn(),\n  asRelativePath: jest.fn((path) => path.toString()),\n};\n\nexport const Uri = {\n  file: jest.fn((path: string) => ({ fsPath: path, toString: () => path })),\n  joinPath: jest.fn((...paths: any[]) => ({\n    fsPath: paths.join('/'),\n    toString: () => paths.join('/'),\n  })),\n};\n\nexport class Range {\n  constructor(\n    public startLine: number,\n    public startCharacter: number,\n    public endLine: number,\n    public endCharacter: number\n  ) {}\n}\n\nexport class WorkspaceEdit {\n  replace = jest.fn();\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/setup.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .acquireVsCodeApi on an `any` value.","line":5,"column":1,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":5,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[225,228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[225,228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[479,482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[479,482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe spread of an `any` array type.","line":22,"column":33,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":22,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/algorithms/AddressBlockRepacker.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any[]` assigned to a parameter of type `AddressBlockRecord[]`.","line":177,"column":43,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":177,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  repackBlocksForward,\n  repackBlocksBackward,\n} from \"../../../webview/algorithms/AddressBlockRepacker\";\n\ndescribe(\"AddressBlockRepacker\", () => {\n  describe(\"repackBlocksForward\", () => {\n    it(\"should repack blocks forward maintaining sizes\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x2000, size: 0x1000 },\n        { name: \"Block3\", base_address: 0x5000, size: 0x2000 },\n      ];\n\n      const result = repackBlocksForward(blocks, 1);\n\n      // Block 0 unchanged, blocks 1-2 repacked sequentially\n      expect(result[0].base_address).toBe(0x0000);\n      expect(result[1].base_address).toBe(0x1000); // After block 0\n      expect(result[2].base_address).toBe(0x2000); // After block 1\n    });\n\n    it(\"should handle repacking from index 0\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x1000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x5000, size: 0x2000 },\n      ];\n\n      const result = repackBlocksForward(blocks, 0);\n\n      // All blocks repacked from address 0\n      expect(result[0].base_address).toBe(0);\n      expect(result[1].base_address).toBe(0x1000);\n    });\n\n    it(\"should handle blocks with varying sizes\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x100 },\n        { name: \"Block2\", base_address: 0x1000, size: 0x2000 },\n        { name: \"Block3\", base_address: 0x5000, size: 0x500 },\n      ];\n\n      const result = repackBlocksForward(blocks, 1);\n\n      expect(result[0].base_address).toBe(0x0000);\n      expect(result[1].base_address).toBe(0x100); // 0x000 + 0x100\n      expect(result[2].base_address).toBe(0x2100); // 0x100 + 0x2000\n    });\n\n    it(\"should preserve original array\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x2000, size: 0x1000 },\n      ];\n\n      const result = repackBlocksForward(blocks, 1);\n\n      // Original should be unchanged\n      expect(blocks[1].base_address).toBe(0x2000);\n      expect(result[1].base_address).toBe(0x1000);\n    });\n\n    it(\"should handle single block\", () => {\n      const blocks = [{ name: \"Block1\", base_address: 0x5000, size: 0x1000 }];\n\n      const result = repackBlocksForward(blocks, 0);\n\n      expect(result[0].base_address).toBe(0);\n    });\n\n    it(\"should handle empty array\", () => {\n      const result = repackBlocksForward([], 0);\n      expect(result).toEqual([]);\n    });\n\n    it(\"should handle type coercion for size property\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x2000, size: undefined as any },\n      ];\n\n      const result = repackBlocksForward(blocks, 1);\n\n      // Should use 0 for undefined size\n      expect(result[1].base_address).toBe(0x1000);\n    });\n  });\n\n  describe(\"repackBlocksBackward\", () => {\n    it(\"should repack blocks backward maintaining sizes\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x2000, size: 0x1000 },\n        { name: \"Block3\", base_address: 0x5000, size: 0x2000 },\n      ];\n\n      const result = repackBlocksBackward(blocks, 1);\n\n      // Block 2 unchanged, blocks 0-1 repacked backward\n      expect(result[2].base_address).toBe(0x5000);\n      expect(result[1].base_address).toBe(0x4000); // 0x5000 - 0x1000\n      expect(result[0].base_address).toBe(0x3000); // 0x4000 - 0x1000\n    });\n\n    it(\"should handle repacking to end when fromIndex is last\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x1000, size: 0x2000 },\n      ];\n\n      const result = repackBlocksBackward(blocks, 1);\n\n      // Last block stays in place\n      expect(result[1].base_address).toBe(0x1000);\n      expect(result[0].base_address).toBeGreaterThanOrEqual(0);\n    });\n\n    it(\"should clamp to address 0\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x1000, size: 0x5000 }, // Too large\n        { name: \"Block2\", base_address: 0x2000, size: 0x1000 },\n      ];\n\n      const result = repackBlocksBackward(blocks, 0);\n\n      // Should clamp block 0 to address 0\n      expect(result[0].base_address).toBe(0);\n    });\n\n    it(\"should preserve original array\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0x5000, size: 0x2000 },\n      ];\n\n      const result = repackBlocksBackward(blocks, 0);\n\n      // Original unchanged\n      expect(blocks[0].base_address).toBe(0x0000);\n      expect(result).not.toBe(blocks);\n    });\n\n    it(\"should handle empty array\", () => {\n      const result = repackBlocksBackward([], 0);\n      expect(result).toEqual([]);\n    });\n\n    it(\"should handle single block\", () => {\n      const blocks = [{ name: \"Block1\", base_address: 0x5000, size: 0x1000 }];\n\n      const result = repackBlocksBackward(blocks, 0);\n\n      expect(result[0].base_address).toBe(0x5000);\n    });\n  });\n\n  describe(\"Edge cases\", () => {\n    it(\"should handle zero-sized blocks\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000, size: 0 },\n        { name: \"Block2\", base_address: 0x1000, size: 0x1000 },\n      ];\n\n      const forward = repackBlocksForward(blocks, 1);\n      expect(forward[1].base_address).toBe(0); // After zero-sized block\n\n      const backward = repackBlocksBackward(blocks, 0);\n      expect(backward[0].base_address).toBeGreaterThanOrEqual(0);\n    });\n\n    it(\"should handle missing size property\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0x0000 } as any,\n        { name: \"Block2\", base_address: 0x1000, size: 0x1000 },\n      ];\n\n      const forward = repackBlocksForward(blocks, 0);\n      expect(forward[0].base_address).toBe(0);\n    });\n\n    it(\"should handle very large addresses\", () => {\n      const blocks = [\n        { name: \"Block1\", base_address: 0xffff0000, size: 0x1000 },\n        { name: \"Block2\", base_address: 0xffff5000, size: 0x1000 },\n      ];\n\n      const result = repackBlocksForward(blocks, 1);\n      expect(result[1].base_address).toBe(0xffff1000);\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/algorithms/BitFieldRepacker.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/algorithms/RegisterRepacker.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/components/DetailsPanel.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/components/EditableTable.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/hooks/useFieldEditor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/services/SpatialInsertionService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/services/YamlService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/utils/BitFieldUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/utils/ErrorHandler.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/test/suite/utils/Logger.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/utils/ErrorHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/utils/Logger.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":107,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":107,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as vscode from \"vscode\";\n\n/**\n * Log levels for extension logging\n */\nexport enum LogLevel {\n  DEBUG = \"DEBUG\",\n  INFO = \"INFO\",\n  WARN = \"WARN\",\n  ERROR = \"ERROR\",\n}\n\n/**\n * Logger service for structured logging throughout the extension\n */\nexport class Logger {\n  private static outputChannel: vscode.OutputChannel | null = null;\n  private static logLevel: LogLevel = LogLevel.INFO;\n\n  constructor(private readonly context: string) {}\n\n  /**\n   * Initialize the logger with a VS Code output channel\n   */\n  static initialize(\n    channelName: string,\n    level: LogLevel = LogLevel.INFO,\n  ): void {\n    this.outputChannel = vscode.window.createOutputChannel(channelName);\n    this.logLevel = level;\n  }\n\n  /**\n   * Get the output channel (create if doesn't exist)\n   */\n  private static getChannel(): vscode.OutputChannel {\n    if (!this.outputChannel) {\n      this.outputChannel = vscode.window.createOutputChannel(\n        \"FPGA Memory Map Editor\",\n      );\n    }\n    return this.outputChannel;\n  }\n\n  /**\n   * Set the global log level\n   */\n  static setLogLevel(level: LogLevel): void {\n    this.logLevel = level;\n  }\n\n  /**\n   * Write a message to the output channel\n   */\n  private log(level: LogLevel, message: string, ...args: unknown[]): void {\n    const channel = Logger.getChannel();\n    const timestamp = new Date().toISOString();\n    const formattedArgs = args.map((arg) => this.formatArg(arg)).join(\" \");\n    const logMessage = `[${timestamp}] [${level}] [${this.context}] ${message}${formattedArgs ? \" \" + formattedArgs : \"\"}`;\n\n    channel?.appendLine(logMessage);\n\n    // Also log to console in development\n    if (process.env.NODE_ENV === \"development\") {\n      const consoleMethod = this.getConsoleMethod(level);\n      consoleMethod(`[${this.context}]`, message, ...args);\n    }\n  }\n\n  /**\n   * Format an argument for logging\n   */\n  private formatArg(arg: unknown): string {\n    if (arg === null) {\n      return \"null\";\n    }\n    if (arg === undefined) {\n      return \"undefined\";\n    }\n    if (arg instanceof Error) {\n      return `Error: ${arg.message}\\n${arg.stack ?? \"\"}`;\n    }\n    if (typeof arg === \"object\") {\n      try {\n        return JSON.stringify(arg, null, 2);\n      } catch {\n        return String(arg);\n      }\n    }\n    return String(arg);\n  }\n\n  /**\n   * Get the appropriate console method for a log level\n   */\n  private getConsoleMethod(level: LogLevel): (...args: unknown[]) => void {\n    switch (level) {\n      case LogLevel.DEBUG:\n        return console.debug;\n      case LogLevel.INFO:\n        return console.info;\n      case LogLevel.WARN:\n        return console.warn;\n      case LogLevel.ERROR:\n        return console.error;\n      default:\n        return console.log;\n    }\n  }\n\n  /**\n   * Check if a log level should be logged based on current log level\n   */\n  private shouldLog(level: LogLevel): boolean {\n    const levels = [\n      LogLevel.DEBUG,\n      LogLevel.INFO,\n      LogLevel.WARN,\n      LogLevel.ERROR,\n    ];\n    const currentIndex = levels.indexOf(Logger.logLevel);\n    const messageIndex = levels.indexOf(level);\n    return messageIndex >= currentIndex;\n  }\n\n  /**\n   * Log a debug message\n   */\n  debug(message: string, ...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.DEBUG)) {\n      this.log(LogLevel.DEBUG, message, ...args);\n    }\n  }\n\n  /**\n   * Log an info message\n   */\n  info(message: string, ...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.INFO)) {\n      this.log(LogLevel.INFO, message, ...args);\n    }\n  }\n\n  /**\n   * Log a warning message\n   */\n  warn(message: string, ...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.WARN)) {\n      this.log(LogLevel.WARN, message, ...args);\n    }\n  }\n\n  /**\n   * Log an error message\n   */\n  error(message: string, error?: Error, ...args: unknown[]): void {\n    if (this.shouldLog(LogLevel.ERROR)) {\n      const allArgs = error ? [error, ...args] : args;\n      this.log(LogLevel.ERROR, message, ...allArgs);\n    }\n  }\n\n  /**\n   * Show the output channel\n   */\n  static show(): void {\n    this.getChannel().show();\n  }\n\n  /**\n   * Dispose of the output channel\n   */\n  static dispose(): void {\n    this.outputChannel?.dispose();\n    this.outputChannel = null;\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/algorithms/AddressBlockRepacker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/algorithms/BitFieldRepacker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/algorithms/RegisterRepacker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/AddressMapVisualizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/BitFieldVisualizer.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":880,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":880,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26450,26453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26450,26453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":888,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":888,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26853,26856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26853,26856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/DetailsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/Outline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/RegisterMapVisualizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/memorymap/BlockEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/memorymap/MemoryMapEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .blur on an `any` value.","line":148,"column":9,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":148,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":148,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":148,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5028,5031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5028,5031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\nimport type { YamlUpdateHandler } from '../../types/editor';\nimport { VSCodeTextField, VSCodeTextArea } from '@vscode/webview-ui-toolkit/react';\nimport { KeyboardShortcutsButton } from '../../shared/components';\nimport AddressMapVisualizer from '../AddressMapVisualizer';\nimport { FIELD_COLORS, FIELD_COLOR_KEYS } from '../../shared/colors';\nimport {\n  SpatialInsertionService,\n  AddressBlockRuntimeDef,\n} from '../../services/SpatialInsertionService';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ntype BlockEditKey = 'name' | 'base' | 'size' | 'usage' | 'description';\ntype BlockActiveCell = { rowIndex: number; key: BlockEditKey };\nconst BLOCK_COLUMN_ORDER: BlockEditKey[] = ['name', 'base', 'size', 'usage', 'description'];\n\nexport interface MemoryMapBlockDef extends AddressBlockRuntimeDef {\n  usage?: string;\n  description?: string;\n}\n\nexport interface MemoryMapEditorProps {\n  /** The memory map object (has name, description, address_blocks / addressBlocks). */\n  memoryMap: {\n    name?: string;\n    description?: string;\n    address_blocks?: MemoryMapBlockDef[];\n    addressBlocks?: MemoryMapBlockDef[];\n    [k: string]: unknown;\n  };\n  selectionMeta?: {\n    absoluteAddress?: number;\n    relativeOffset?: number;\n    focusDetails?: boolean;\n  };\n  onUpdate: YamlUpdateHandler;\n  onNavigateToBlock?: (blockIndex: number) => void;\n}\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\n/**\n * Calculates block size in bytes based on its registers or explicit size field.\n */\nfunction calculateBlockSize(block: MemoryMapBlockDef): number {\n  const registers = block?.registers ?? [];\n  if (registers.length === 0) {\n    const sz = block?.size ?? block?.range ?? 4;\n    return typeof sz === 'string' ? Number.parseInt(sz, 10) || 4 : sz;\n  }\n  let totalSize = 0;\n  for (const reg of registers as Record<string, unknown>[]) {\n    if (reg.__kind === 'array') {\n      const count = (reg.count as number) || 1;\n      const stride = (reg.stride as number) || 4;\n      totalSize += count * stride;\n    } else {\n      totalSize += 4;\n    }\n  }\n  return totalSize;\n}\n\n// ---------------------------------------------------------------------------\n// Component\n// ---------------------------------------------------------------------------\n\n/**\n * Renders and manages editing of a memory map's address blocks,\n * including the AddressMapVisualizer and keyboard-navigable blocks table.\n */\nexport function MemoryMapEditor({\n  memoryMap,\n  selectionMeta,\n  onUpdate,\n  onNavigateToBlock,\n}: MemoryMapEditorProps) {\n  const blocks = memoryMap?.address_blocks ?? memoryMap?.addressBlocks ?? [];\n\n  const [selectedBlockIndex, setSelectedBlockIndex] = useState<number>(-1);\n  const [hoveredBlockIndex, setHoveredBlockIndex] = useState<number | null>(null);\n  const [blockActiveCell, setBlockActiveCell] = useState<BlockActiveCell>({\n    rowIndex: -1,\n    key: 'name',\n  });\n  const [insertError, setInsertError] = useState<string | null>(null);\n\n  const focusRef = useRef<HTMLDivElement | null>(null);\n\n  // Auto-focus on explicit request.\n  useEffect(() => {\n    if (!selectionMeta?.focusDetails) {\n      return;\n    }\n    const id = window.setTimeout(() => {\n      focusRef.current?.focus();\n    }, 0);\n    return () => window.clearTimeout(id);\n  }, [selectionMeta?.focusDetails, memoryMap?.name]);\n\n  // Clamp selection when map changes.\n  useEffect(() => {\n    const currentBlocks = memoryMap?.address_blocks ?? memoryMap?.addressBlocks ?? [];\n    if (!Array.isArray(currentBlocks) || currentBlocks.length === 0) {\n      setSelectedBlockIndex(-1);\n      setBlockActiveCell({ rowIndex: -1, key: 'name' });\n      return;\n    }\n    setSelectedBlockIndex((prev) => {\n      if (prev < 0) {\n        return 0;\n      }\n      if (prev >= currentBlocks.length) {\n        return currentBlocks.length - 1;\n      }\n      return prev;\n    });\n    setBlockActiveCell((prev) => {\n      const rowIndex = prev.rowIndex < 0 ? 0 : Math.min(currentBlocks.length - 1, prev.rowIndex);\n      const key = BLOCK_COLUMN_ORDER.includes(prev.key) ? prev.key : 'name';\n      return { rowIndex, key };\n    });\n  }, [memoryMap?.name, (memoryMap?.address_blocks ?? memoryMap?.addressBlocks ?? []).length]);\n\n  // Escape: return focus from inline editor back to the table.\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'Escape') {\n        return;\n      }\n      const activeEl = document.activeElement as HTMLElement | null;\n      if (!activeEl) {\n        return;\n      }\n      const inBlocks =\n        !!focusRef.current && focusRef.current.contains(activeEl) && activeEl !== focusRef.current;\n      if (!inBlocks) {\n        return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n      try {\n        (activeEl as any).blur?.();\n      } catch {\n        // ignore\n      }\n      window.setTimeout(() => focusRef.current?.focus(), 0);\n    };\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, []);\n\n  // Keyboard shortcuts.\n  useEffect(() => {\n    const liveBlocks = memoryMap?.address_blocks ?? memoryMap?.addressBlocks ?? [];\n\n    const tryInsertBlock = (after: boolean) => {\n      setInsertError(null);\n      const result = after\n        ? SpatialInsertionService.insertBlockAfter(liveBlocks, selectedBlockIndex)\n        : SpatialInsertionService.insertBlockBefore(liveBlocks, selectedBlockIndex);\n\n      if (result.error) {\n        setInsertError(result.error);\n        return;\n      }\n\n      const newIdx = result.newIndex;\n      onUpdate(['addressBlocks'], result.items);\n      setSelectedBlockIndex(newIdx);\n      setHoveredBlockIndex(newIdx);\n      setBlockActiveCell({ rowIndex: newIdx, key: 'name' });\n      window.setTimeout(() => {\n        document\n          .querySelector(`tr[data-block-idx=\"${newIdx}\"]`)\n          ?.scrollIntoView({ block: 'center' });\n      }, 100);\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      let keyLower = (e.key || '').toLowerCase();\n      if (e.altKey && e.code) {\n        if (e.code === 'KeyH') {\n          keyLower = 'h';\n        }\n        if (e.code === 'KeyJ') {\n          keyLower = 'j';\n        }\n        if (e.code === 'KeyK') {\n          keyLower = 'k';\n        }\n        if (e.code === 'KeyL') {\n          keyLower = 'l';\n        }\n      }\n      const vimToArrow: Record<string, 'ArrowLeft' | 'ArrowDown' | 'ArrowUp' | 'ArrowRight'> = {\n        h: 'ArrowLeft',\n        j: 'ArrowDown',\n        k: 'ArrowUp',\n        l: 'ArrowRight',\n      };\n      const normalizedKey: string = vimToArrow[keyLower] ?? e.key;\n\n      const isArrow = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(normalizedKey);\n      const isEdit = normalizedKey === 'F2' || keyLower === 'e';\n      const isDelete = keyLower === 'd' || e.key === 'Delete';\n      const isInsertAfter = keyLower === 'o' && !e.shiftKey;\n      const isInsertBefore = keyLower === 'o' && e.shiftKey;\n      if (!isArrow && !isEdit && !isDelete && !isInsertAfter && !isInsertBefore) {\n        return;\n      }\n      if (e.ctrlKey || e.metaKey) {\n        return;\n      }\n\n      const activeEl = document.activeElement as HTMLElement | null;\n      const isInBlocksArea =\n        !!focusRef.current &&\n        !!activeEl &&\n        (activeEl === focusRef.current || focusRef.current.contains(activeEl));\n      if (!isInBlocksArea) {\n        return;\n      }\n\n      const target = e.target as HTMLElement | null;\n      const isTypingTarget = !!target?.closest(\n        'input, textarea, select, [contenteditable=\"true\"], vscode-text-field, vscode-text-area, vscode-dropdown'\n      );\n      if (isTypingTarget) {\n        return;\n      }\n\n      const scrollToCell = (rowIndex: number, key: BlockEditKey) => {\n        window.setTimeout(() => {\n          const row = document.querySelector(`tr[data-block-idx=\"${rowIndex}\"]`);\n          row?.scrollIntoView({ block: 'nearest' });\n          const cell = row?.querySelector(`td[data-col-key=\"${key}\"]`) as HTMLElement | null;\n          cell?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n        }, 0);\n      };\n\n      const focusEditor = (rowIndex: number, key: BlockEditKey) => {\n        window.setTimeout(() => {\n          const row = document.querySelector(`tr[data-block-idx=\"${rowIndex}\"]`);\n          const editor = row?.querySelector(`[data-edit-key=\"${key}\"]`) as HTMLElement | null;\n          editor?.focus?.();\n        }, 0);\n      };\n\n      const currentRow =\n        blockActiveCell.rowIndex >= 0\n          ? blockActiveCell.rowIndex\n          : selectedBlockIndex >= 0\n            ? selectedBlockIndex\n            : 0;\n      const currentKey: BlockEditKey = BLOCK_COLUMN_ORDER.includes(blockActiveCell.key)\n        ? blockActiveCell.key\n        : 'name';\n\n      if (isEdit) {\n        if (currentRow < 0 || currentRow >= liveBlocks.length) {\n          return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        setSelectedBlockIndex(currentRow);\n        setHoveredBlockIndex(currentRow);\n        setBlockActiveCell({ rowIndex: currentRow, key: currentKey });\n        focusEditor(currentRow, currentKey);\n        return;\n      }\n      if (isInsertAfter || isInsertBefore) {\n        e.preventDefault();\n        e.stopPropagation();\n        tryInsertBlock(isInsertAfter);\n        return;\n      }\n      if (isDelete) {\n        if (currentRow < 0 || currentRow >= liveBlocks.length) {\n          return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        const newBlocks = liveBlocks.filter((_: unknown, i: number) => i !== currentRow);\n        onUpdate(['addressBlocks'], newBlocks);\n        const nextRow = currentRow > 0 ? currentRow - 1 : newBlocks.length > 0 ? 0 : -1;\n        setSelectedBlockIndex(nextRow);\n        setHoveredBlockIndex(nextRow);\n        setBlockActiveCell({ rowIndex: nextRow, key: currentKey });\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n      if (liveBlocks.length === 0) {\n        return;\n      }\n\n      const isVertical = normalizedKey === 'ArrowUp' || normalizedKey === 'ArrowDown';\n      const delta = normalizedKey === 'ArrowUp' || normalizedKey === 'ArrowLeft' ? -1 : 1;\n\n      if (isVertical) {\n        const nextRow = Math.max(0, Math.min(liveBlocks.length - 1, currentRow + delta));\n        setSelectedBlockIndex(nextRow);\n        setHoveredBlockIndex(nextRow);\n        setBlockActiveCell({ rowIndex: nextRow, key: currentKey });\n        scrollToCell(nextRow, currentKey);\n        return;\n      }\n\n      const currentCol = Math.max(0, BLOCK_COLUMN_ORDER.indexOf(currentKey));\n      const nextCol = Math.max(0, Math.min(BLOCK_COLUMN_ORDER.length - 1, currentCol + delta));\n      const nextKey = BLOCK_COLUMN_ORDER[nextCol] ?? 'name';\n      setSelectedBlockIndex(currentRow);\n      setHoveredBlockIndex(currentRow);\n      setBlockActiveCell({ rowIndex: currentRow, key: nextKey });\n      scrollToCell(currentRow, nextKey);\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [memoryMap, selectedBlockIndex, hoveredBlockIndex, blockActiveCell, onUpdate]);\n\n  const toHex = (n: number) => `0x${Math.max(0, n).toString(16).toUpperCase()}`;\n  const getBlockColor = (idx: number) => FIELD_COLOR_KEYS[idx % FIELD_COLOR_KEYS.length];\n\n  return (\n    <div className=\"flex flex-col w-full h-full min-h-0\">\n      {/* Header + AddressMapVisualizer */}\n      <div className=\"vscode-surface border-b vscode-border p-8 flex flex-col gap-6 shrink-0 relative overflow-hidden\">\n        <div className=\"flex justify-between items-start relative z-10\">\n          <div>\n            <h2 className=\"text-2xl font-bold font-mono tracking-tight\">\n              {memoryMap?.name ?? 'Memory Map'}\n            </h2>\n            <p className=\"vscode-muted text-sm mt-1 max-w-2xl\">\n              {memoryMap?.description ?? 'Address space layout'}\n            </p>\n          </div>\n        </div>\n        <div className=\"w-full relative z-10 mt-2 select-none\">\n          <AddressMapVisualizer\n            blocks={blocks}\n            hoveredBlockIndex={hoveredBlockIndex}\n            setHoveredBlockIndex={setHoveredBlockIndex}\n            onBlockClick={onNavigateToBlock}\n          />\n        </div>\n      </div>\n\n      {/* Blocks table */}\n      <div className=\"flex-1 flex overflow-hidden min-h-0\">\n        <div className=\"flex-1 vscode-surface min-h-0 flex flex-col\">\n          <div\n            ref={focusRef}\n            tabIndex={0}\n            data-blocks-table=\"true\"\n            className=\"flex-1 overflow-auto min-h-0 outline-none focus:outline-none\"\n          >\n            {insertError ? (\n              <div className=\"vscode-error px-4 py-2 text-xs\">{insertError}</div>\n            ) : null}\n            <table className=\"w-full text-left border-collapse table-fixed\">\n              <colgroup>\n                <col className=\"w-[25%] min-w-[200px]\" />\n                <col className=\"w-[20%] min-w-[120px]\" />\n                <col className=\"w-[15%] min-w-[100px]\" />\n                <col className=\"w-[15%] min-w-[100px]\" />\n                <col className=\"w-[25%]\" />\n              </colgroup>\n              <thead className=\"vscode-surface-alt text-xs font-semibold vscode-muted uppercase tracking-wider sticky top-0 z-10 shadow-sm\">\n                <tr className=\"h-12\">\n                  <th className=\"px-6 py-3 border-b vscode-border align-middle\">Name</th>\n                  <th className=\"px-4 py-3 border-b vscode-border align-middle\">Base Address</th>\n                  <th className=\"px-4 py-3 border-b vscode-border align-middle\">Size</th>\n                  <th className=\"px-4 py-3 border-b vscode-border align-middle\">Usage</th>\n                  <th className=\"px-6 py-3 border-b vscode-border align-middle\">Description</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y vscode-border text-sm\">\n                {blocks.map((block: MemoryMapBlockDef, idx: number) => {\n                  const color = getBlockColor(idx);\n                  const base = block.base_address ?? block.offset ?? 0;\n                  const size = calculateBlockSize(block);\n\n                  return (\n                    <tr\n                      key={idx}\n                      data-block-idx={idx}\n                      className={`group transition-colors border-l-4 border-transparent h-12 ${\n                        idx === selectedBlockIndex\n                          ? 'vscode-focus-border vscode-row-selected'\n                          : idx === hoveredBlockIndex\n                            ? 'vscode-focus-border vscode-row-hover'\n                            : ''\n                      }`}\n                      onMouseEnter={() => setHoveredBlockIndex(idx)}\n                      onMouseLeave={() => setHoveredBlockIndex(null)}\n                      onClick={() => {\n                        setSelectedBlockIndex(idx);\n                        setHoveredBlockIndex(idx);\n                        setBlockActiveCell((prev) => ({ rowIndex: idx, key: prev.key }));\n                      }}\n                    >\n                      <td\n                        data-col-key=\"name\"\n                        className={`px-6 py-2 font-medium align-middle ${\n                          blockActiveCell.rowIndex === idx && blockActiveCell.key === 'name'\n                            ? 'vscode-cell-active'\n                            : ''\n                        }`}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedBlockIndex(idx);\n                          setHoveredBlockIndex(idx);\n                          setBlockActiveCell({ rowIndex: idx, key: 'name' });\n                        }}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <div\n                            className=\"w-2.5 h-2.5 rounded-sm\"\n                            style={{ backgroundColor: FIELD_COLORS[color] || color }}\n                          />\n                          <VSCodeTextField\n                            data-edit-key=\"name\"\n                            className=\"flex-1\"\n                            value={block.name || ''}\n                            onBlur={(e: Event | React.FocusEvent<HTMLElement>) =>\n                              onUpdate(\n                                ['addressBlocks', idx, 'name'],\n                                (e.target as HTMLInputElement).value\n                              )\n                            }\n                          />\n                        </div>\n                      </td>\n                      <td\n                        data-col-key=\"base\"\n                        className={`px-4 py-2 font-mono vscode-muted align-middle ${\n                          blockActiveCell.rowIndex === idx && blockActiveCell.key === 'base'\n                            ? 'vscode-cell-active'\n                            : ''\n                        }`}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedBlockIndex(idx);\n                          setHoveredBlockIndex(idx);\n                          setBlockActiveCell({ rowIndex: idx, key: 'base' });\n                        }}\n                      >\n                        <VSCodeTextField\n                          data-edit-key=\"base\"\n                          className=\"w-full font-mono\"\n                          value={toHex(base)}\n                          onInput={(e: Event | React.FormEvent<HTMLElement>) => {\n                            const val = Number.parseInt((e.target as HTMLInputElement).value, 0);\n                            if (!Number.isNaN(val)) {\n                              onUpdate(['addressBlocks', idx, 'offset'], val);\n                            }\n                          }}\n                        />\n                      </td>\n                      <td\n                        data-col-key=\"size\"\n                        className={`px-4 py-2 font-mono vscode-muted align-middle ${\n                          blockActiveCell.rowIndex === idx && blockActiveCell.key === 'size'\n                            ? 'vscode-cell-active'\n                            : ''\n                        }`}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedBlockIndex(idx);\n                          setHoveredBlockIndex(idx);\n                          setBlockActiveCell({ rowIndex: idx, key: 'size' });\n                        }}\n                      >\n                        {size < 1024 ? `${size}B` : `${(size / 1024).toFixed(1)}KB`}\n                      </td>\n                      <td\n                        data-col-key=\"usage\"\n                        className={`px-4 py-2 align-middle ${\n                          blockActiveCell.rowIndex === idx && blockActiveCell.key === 'usage'\n                            ? 'vscode-cell-active'\n                            : ''\n                        }`}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedBlockIndex(idx);\n                          setHoveredBlockIndex(idx);\n                          setBlockActiveCell({ rowIndex: idx, key: 'usage' });\n                        }}\n                      >\n                        <span className=\"px-2 py-0.5 rounded text-xs font-medium vscode-badge whitespace-nowrap\">\n                          {block.usage ?? 'register'}\n                        </span>\n                      </td>\n                      <td\n                        data-col-key=\"description\"\n                        className={`px-6 py-2 vscode-muted align-middle ${\n                          blockActiveCell.rowIndex === idx && blockActiveCell.key === 'description'\n                            ? 'vscode-cell-active'\n                            : ''\n                        }`}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setSelectedBlockIndex(idx);\n                          setHoveredBlockIndex(idx);\n                          setBlockActiveCell({ rowIndex: idx, key: 'description' });\n                        }}\n                      >\n                        <VSCodeTextArea\n                          data-edit-key=\"description\"\n                          className=\"w-full\"\n                          rows={1}\n                          value={block.description ?? ''}\n                          onInput={(e: Event | React.FormEvent<HTMLElement>) =>\n                            onUpdate(\n                              ['addressBlocks', idx, 'description'],\n                              (e.target as HTMLInputElement).value\n                            )\n                          }\n                        />\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n      <KeyboardShortcutsButton context=\"memoryMap\" />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/memorymap/RegisterArrayEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/register/FieldsTable.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":292,"column":23,"nodeType":"LogicalExpression","messageId":"preferOptionalChain","endLine":292,"endColumn":42,"suggestions":[{"messageId":"optionalChainSuggest","fix":{"range":[9670,9689],"text":"field?.name"},"desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":354,"column":44,"nodeType":"LogicalExpression","messageId":"preferOptionalChain","endLine":354,"endColumn":79,"suggestions":[{"messageId":"optionalChainSuggest","fix":{"range":[13024,13059],"text":"FIELD_COLORS?.[color]"},"desc":"Change to an optional chain."}]}],"suppressedMessages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\[.","line":86,"column":41,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":86,"endColumn":42,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2727,2728],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2727,2727],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport type { YamlUpdateHandler } from '../../types/editor';\nimport {\n  VSCodeDropdown,\n  VSCodeOption,\n  VSCodeTextField,\n  VSCodeTextArea,\n} from '@vscode/webview-ui-toolkit/react';\nimport { EditableTable } from '../../shared/components';\nimport { FIELD_COLORS, getFieldColor } from '../../shared/colors';\nimport { formatBits } from '../../algorithms/BitFieldRepacker';\nimport { fieldToBitsString } from '../../utils/BitFieldUtils';\nimport { validateVhdlIdentifier } from '../../shared/utils/validation';\nimport type { FieldEditorState } from '../../hooks/useFieldEditor';\n\nexport interface FieldDef {\n  name?: string | null;\n  bits?: string | null;\n  bit_offset?: number | null;\n  bit_width?: number | null;\n  bit_range?: [number, number] | null;\n  access?: string | null;\n  reset_value?: number | null;\n  description?: string | null;\n  [key: string]: unknown;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst ACCESS_OPTIONS = [\n  'read-only',\n  'write-only',\n  'read-write',\n  'write-1-to-clear',\n  'read-write-1-to-clear',\n];\n\nconst FIELD_TABLE_COLUMNS = [\n  { key: 'name', header: 'Name' },\n  { key: 'bits', header: 'Bit(s)' },\n  { key: 'access', header: 'Access' },\n  { key: 'reset', header: 'Reset' },\n  { key: 'description', header: 'Description' },\n];\n\n// ---------------------------------------------------------------------------\n// Validation helpers (register-editor utilities)\n// ---------------------------------------------------------------------------\n\n/** Returns the width represented by \"[N:M]\" or \"[N]\" strings. */\nfunction parseBitsWidth(bits: string): number | null {\n  const match = bits.trim().match(/^\\[(\\d+)(?::(\\d+))?\\]$/);\n  if (!match) {\n    return null;\n  }\n  const n = parseInt(match[1], 10);\n  const m = match[2] ? parseInt(match[2], 10) : n;\n  return Math.abs(n - m) + 1;\n}\n\n/** Returns an error message for an invalid bits string, or null if valid. */\nfunction validateBitsString(bits: string): string | null {\n  const trimmed = bits.trim();\n  if (!/^\\[\\d+(?::\\d+)?\\]$/.test(trimmed)) {\n    return 'Format must be [N:M] or [N]';\n  }\n  const match = trimmed.match(/\\[(\\d+)(?::(\\d+))?\\]/);\n  if (!match) {\n    return 'Invalid format';\n  }\n  const n = parseInt(match[1], 10);\n  const m = match[2] ? parseInt(match[2], 10) : n;\n  if (n < 0 || m < 0) {\n    return 'Bit indices must be >= 0';\n  }\n  if (n < m) {\n    return 'MSB must be >= LSB';\n  }\n  return null;\n}\n\n/** Parses a bit string like \"[7:4]\" or \"[3]\" into {bit_offset, bit_width, bit_range}. */\nfunction parseBitsInput(text: string) {\n  const trimmed = text.trim().replace(/[\\[\\]]/g, ''); // eslint-disable-line no-useless-escape\n  if (!trimmed) {\n    return null;\n  }\n  const parts = trimmed.split(':').map((p) => Number(p.trim()));\n  if (parts.some((p) => Number.isNaN(p))) {\n    return null;\n  }\n  let msb: number;\n  let lsb: number;\n  if (parts.length === 1) {\n    msb = parts[0];\n    lsb = parts[0];\n  } else {\n    [msb, lsb] = parts as [number, number];\n  }\n  if (!Number.isFinite(msb) || !Number.isFinite(lsb)) {\n    return null;\n  }\n  if (msb < lsb) {\n    const tmp = msb;\n    msb = lsb;\n    lsb = tmp;\n  }\n  return {\n    bit_offset: lsb,\n    bit_width: msb - lsb + 1,\n    bit_range: [msb, lsb] as [number, number],\n  };\n}\n\n/** Parses a hex or decimal string to a number, or returns null. */\nfunction parseReset(text: string): number | null {\n  const s = text.trim();\n  if (!s) {\n    return null;\n  }\n  const v = Number.parseInt(s, 0);\n  return Number.isFinite(v) ? v : null;\n}\n\nfunction getFieldBitWidth(f: FieldDef): number {\n  const w = Number(f?.bit_width);\n  if (Number.isFinite(w) && w > 0) {\n    return w;\n  }\n  const br = f?.bit_range;\n  if (Array.isArray(br) && br.length === 2) {\n    const msb = Number(br[0]);\n    const lsb = Number(br[1]);\n    if (Number.isFinite(msb) && Number.isFinite(lsb)) {\n      return Math.abs(msb - lsb) + 1;\n    }\n  }\n  return 1;\n}\n\nfunction validateResetForField(f: FieldDef, value: number | null): string | null {\n  if (value === null) {\n    return null;\n  }\n  if (!Number.isFinite(value)) {\n    return 'Invalid number';\n  }\n  if (value < 0) {\n    return 'Reset must be >= 0';\n  }\n  const width = getFieldBitWidth(f);\n  const max = width >= 53 ? Number.MAX_SAFE_INTEGER : Math.pow(2, width) - 1;\n  if (value > max) {\n    return `Reset too large for ${width} bit(s)`;\n  }\n  return null;\n}\n\n// ---------------------------------------------------------------------------\n// Props\n// ---------------------------------------------------------------------------\n\nexport interface FieldsTableProps {\n  /** Normalised bit fields for the current register. */\n  fields: FieldDef[];\n  /** Register width in bits (used for overflow validation). */\n  registerSize: number;\n  /** Callback to commit a YAML path + value change. */\n  onUpdate: YamlUpdateHandler;\n  /** All editing state from the useFieldEditor hook. */\n  fieldEditor: FieldEditorState;\n}\n\n// ---------------------------------------------------------------------------\n// Component\n// ---------------------------------------------------------------------------\n\n/**\n * Renders the editable bit fields table for a register, including the\n * move-up/move-down toolbar.\n * Delegates insertion/deletion/editing to the useFieldEditor hook state.\n */\nexport function FieldsTable({ fields, registerSize, onUpdate, fieldEditor }: FieldsTableProps) {\n  const {\n    selectedFieldIndex,\n    setSelectedFieldIndex,\n    hoveredFieldIndex,\n    setHoveredFieldIndex,\n    setSelectedEditKey,\n    activeCell,\n    setActiveCell,\n    nameDrafts,\n    setNameDrafts,\n    nameErrors,\n    setNameErrors,\n    bitsDrafts,\n    setBitsDrafts,\n    bitsErrors,\n    setBitsErrors,\n    dragPreviewRanges,\n    resetDrafts,\n    setResetDrafts,\n    resetErrors,\n    setResetErrors,\n    insertError,\n    focusRef,\n    errorRef,\n    ensureDraftsInitialized,\n    moveSelectedField,\n  } = fieldEditor;\n\n  return (\n    <div className=\"flex-1 flex overflow-hidden min-h-0\">\n      <div className=\"flex-1 vscode-surface border-r vscode-border min-h-0 flex flex-col\">\n        {/* Toolbar: move up / move down */}\n        <div className=\"shrink-0 px-4 py-2 border-b vscode-border vscode-surface flex items-center justify-end gap-1\">\n          <button\n            className=\"p-2 rounded-md transition-colors disabled:opacity-40 vscode-icon-button\"\n            onClick={() => moveSelectedField(-1)}\n            disabled={selectedFieldIndex <= 0}\n            title=\"Move field up\"\n            type=\"button\"\n          >\n            <span className=\"codicon codicon-chevron-up\"></span>\n          </button>\n          <button\n            className=\"p-2 rounded-md transition-colors disabled:opacity-40 vscode-icon-button\"\n            onClick={() => moveSelectedField(1)}\n            disabled={selectedFieldIndex < 0 || selectedFieldIndex >= fields.length - 1}\n            title=\"Move field down\"\n            type=\"button\"\n          >\n            <span className=\"codicon codicon-chevron-down\"></span>\n          </button>\n        </div>\n\n        {/* Scrollable table */}\n        <div\n          ref={focusRef}\n          tabIndex={0}\n          data-fields-table=\"true\"\n          className=\"flex-1 overflow-auto min-h-0 outline-none focus:outline-none\"\n          style={{ overflowY: 'auto', overflowX: 'auto' }}\n        >\n          {insertError ? (\n            <div ref={errorRef} className=\"vscode-error px-4 py-2 text-xs\">\n              {insertError}\n            </div>\n          ) : null}\n\n          <EditableTable\n            rows={fields}\n            columns={FIELD_TABLE_COLUMNS}\n            showHeaderSection={false}\n            showTableBorder={false}\n            containerClassName=\"\"\n            tableWrapperClassName=\"\"\n            tableClassName=\"w-full text-left border-collapse table-fixed\"\n            renderTableContent={() => (\n              <>\n                <colgroup>\n                  <col className=\"w-[18%] min-w-[120px]\" />\n                  <col className=\"w-[14%] min-w-[100px]\" />\n                  <col className=\"w-[14%] min-w-[120px]\" />\n                  <col className=\"w-[14%] min-w-[110px]\" />\n                  <col className=\"w-[40%] min-w-[240px]\" />\n                </colgroup>\n                <thead className=\"vscode-surface-alt text-xs font-semibold vscode-muted uppercase tracking-wider sticky top-0 z-10 shadow-sm\">\n                  <tr className=\"h-12\">\n                    <th className=\"px-6 py-3 border-b vscode-border align-middle\">Name</th>\n                    <th className=\"px-4 py-3 border-b vscode-border align-middle\">Bit(s)</th>\n                    <th className=\"px-4 py-3 border-b vscode-border align-middle\">Access</th>\n                    <th className=\"px-4 py-3 border-b vscode-border align-middle\">Reset</th>\n                    <th className=\"px-6 py-3 border-b vscode-border align-middle\">Description</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y vscode-border text-sm\">\n                  {fields.map((field, index) => {\n                    const bits = fieldToBitsString(field);\n                    const color = getFieldColor(\n                      field.name ?? `field${index}`,\n                      field.bit_offset ?? undefined\n                    );\n                    const resetDisplay =\n                      field.reset_value !== null && field.reset_value !== undefined\n                        ? `0x${Number(field.reset_value).toString(16).toUpperCase()}`\n                        : '';\n\n                    const fieldKey =\n                      field && field.name ? `${String(field.name)}` : `index-${index}`;\n                    const nameValue = nameDrafts[fieldKey] ?? String(field.name ?? '');\n                    const nameErr = nameErrors[fieldKey] ?? null;\n\n                    const previewRange = dragPreviewRanges[index];\n                    const bitsValue = previewRange\n                      ? `[${previewRange[0]}:${previewRange[1]}]`\n                      : (bitsDrafts[index] ?? bits);\n                    const bitsErr = bitsErrors[index] ?? null;\n                    const resetValue = resetDrafts[index] ?? (resetDisplay || '0x0');\n                    const resetErr = resetErrors[index] ?? null;\n\n                    return (\n                      <tr\n                        key={index}\n                        data-field-index={index}\n                        className={`group transition-colors border-l-4 border-transparent h-12 ${\n                          index === selectedFieldIndex\n                            ? 'vscode-focus-border vscode-row-selected'\n                            : index === hoveredFieldIndex\n                              ? 'vscode-focus-border vscode-row-hover'\n                              : ''\n                        }`}\n                        style={{ position: 'relative' }}\n                        onMouseEnter={() => setHoveredFieldIndex(index)}\n                        onMouseLeave={() => setHoveredFieldIndex(null)}\n                        onClick={() => {\n                          setSelectedFieldIndex(index);\n                          setHoveredFieldIndex(index);\n                          setActiveCell((prev) => ({ rowIndex: index, key: prev.key }));\n                          ensureDraftsInitialized(index);\n                        }}\n                        id={`row-${String(field.name ?? '')\n                          .toLowerCase()\n                          .replace(/[^a-z0-9_]/g, '-')}`}\n                      >\n                        <>\n                          {/* NAME */}\n                          <td\n                            data-col-key=\"name\"\n                            className={`px-6 py-2 font-medium align-middle ${\n                              activeCell.rowIndex === index && activeCell.key === 'name'\n                                ? 'vscode-cell-active'\n                                : ''\n                            }`}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              ensureDraftsInitialized(index);\n                              setSelectedFieldIndex(index);\n                              setHoveredFieldIndex(index);\n                              setSelectedEditKey('name');\n                              setActiveCell({ rowIndex: index, key: 'name' });\n                            }}\n                          >\n                            <div className=\"flex flex-col justify-center\">\n                              <div className=\"flex items-center gap-2 h-10\">\n                                <div\n                                  className=\"w-2.5 h-2.5 rounded-sm\"\n                                  style={{\n                                    backgroundColor:\n                                      color === 'gray'\n                                        ? '#e5e7eb'\n                                        : (FIELD_COLORS && FIELD_COLORS[color]) || color,\n                                  }}\n                                />\n                                <VSCodeTextField\n                                  data-edit-key=\"name\"\n                                  className=\"flex-1\"\n                                  value={nameValue}\n                                  onFocus={() => {\n                                    ensureDraftsInitialized(index);\n                                    setSelectedFieldIndex(index);\n                                    setHoveredFieldIndex(index);\n                                    setSelectedEditKey('name');\n                                    setActiveCell({ rowIndex: index, key: 'name' });\n                                  }}\n                                  onInput={(e: Event | React.FormEvent<HTMLElement>) => {\n                                    const next = String((e.target as HTMLInputElement).value ?? '');\n                                    setNameDrafts((prev) => ({\n                                      ...prev,\n                                      [fieldKey]: next,\n                                    }));\n                                    const err = validateVhdlIdentifier(next);\n                                    setNameErrors((prev) => ({\n                                      ...prev,\n                                      [fieldKey]: err,\n                                    }));\n                                  }}\n                                  onBlur={(e: Event | React.FocusEvent<HTMLElement>) => {\n                                    const next = String((e.target as HTMLInputElement).value ?? '');\n                                    const err = validateVhdlIdentifier(next);\n                                    if (!err) {\n                                      onUpdate(['fields', index, 'name'], next.trim());\n                                    }\n                                  }}\n                                />\n                              </div>\n                              {nameErr ? (\n                                <div className=\"text-xs vscode-error mt-1\">{nameErr}</div>\n                              ) : null}\n                            </div>\n                          </td>\n\n                          {/* BITS */}\n                          <td\n                            data-col-key=\"bits\"\n                            className={`px-4 py-2 font-mono vscode-muted align-middle ${\n                              activeCell.rowIndex === index && activeCell.key === 'bits'\n                                ? 'vscode-cell-active'\n                                : ''\n                            }`}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              ensureDraftsInitialized(index);\n                              setSelectedFieldIndex(index);\n                              setHoveredFieldIndex(index);\n                              setSelectedEditKey('bits');\n                              setActiveCell({ rowIndex: index, key: 'bits' });\n                            }}\n                          >\n                            <div className=\"flex items-center h-10\">\n                              <div className=\"flex flex-col w-full\">\n                                <VSCodeTextField\n                                  data-edit-key=\"bits\"\n                                  className=\"w-full font-mono\"\n                                  value={bitsValue}\n                                  onFocus={() => {\n                                    ensureDraftsInitialized(index);\n                                    setSelectedFieldIndex(index);\n                                    setHoveredFieldIndex(index);\n                                    setSelectedEditKey('bits');\n                                    setActiveCell({ rowIndex: index, key: 'bits' });\n                                  }}\n                                  onInput={(e: Event | React.FormEvent<HTMLElement>) => {\n                                    const next = String((e.target as HTMLInputElement).value ?? '');\n                                    setBitsDrafts((prev) => ({\n                                      ...prev,\n                                      [index]: next,\n                                    }));\n                                    let err = validateBitsString(next);\n                                    if (!err) {\n                                      const thisWidth = parseBitsWidth(next);\n                                      if (thisWidth !== null) {\n                                        let total = 0;\n                                        for (let i = 0; i < fields.length; ++i) {\n                                          if (i === index) {\n                                            total += thisWidth;\n                                          } else {\n                                            const b = bitsDrafts[i] ?? fieldToBitsString(fields[i]);\n                                            const w = parseBitsWidth(b);\n                                            if (w) {\n                                              total += w;\n                                            }\n                                          }\n                                        }\n                                        if (total > registerSize) {\n                                          err = `Bit fields overflow register (${total} > ${registerSize})`;\n                                        }\n                                      }\n                                    }\n                                    setBitsErrors((prev) => ({\n                                      ...prev,\n                                      [index]: err,\n                                    }));\n                                    if (!err) {\n                                      const updatedFields = fields.map((f, i) => {\n                                        if (i !== index) {\n                                          return { ...f };\n                                        }\n                                        const parsed = parseBitsInput(next);\n                                        if (parsed) {\n                                          return {\n                                            ...f,\n                                            bits: next,\n                                            bit_offset: parsed.bit_offset,\n                                            bit_width: parsed.bit_width,\n                                            bit_range: parsed.bit_range,\n                                          };\n                                        } else {\n                                          return { ...f, bits: next };\n                                        }\n                                      });\n                                      const curr = updatedFields[index];\n                                      const currMSB = curr.bit_range\n                                        ? curr.bit_range[0]\n                                        : Number(curr.bit_offset) + Number(curr.bit_width) - 1;\n                                      let prevMSB = currMSB;\n                                      for (let i = index + 1; i < updatedFields.length; ++i) {\n                                        const f = updatedFields[i];\n                                        const width = Number(f.bit_width) || 1;\n                                        const lsb = Number(prevMSB) + 1;\n                                        const msb = Number(lsb) + width - 1;\n                                        updatedFields[i] = {\n                                          ...f,\n                                          bit_offset: lsb,\n                                          bit_width: width,\n                                          bit_range: [msb, lsb],\n                                          bits: formatBits(msb, lsb),\n                                        };\n                                        prevMSB = msb;\n                                      }\n                                      onUpdate(['fields'], updatedFields);\n                                    }\n                                  }}\n                                />\n                                {bitsErr ? (\n                                  <div className=\"text-xs vscode-error mt-1\">{bitsErr}</div>\n                                ) : null}\n                              </div>\n                            </div>\n                          </td>\n\n                          {/* ACCESS */}\n                          <td\n                            data-col-key=\"access\"\n                            className={`px-4 py-2 align-middle ${\n                              activeCell.rowIndex === index && activeCell.key === 'access'\n                                ? 'vscode-cell-active'\n                                : ''\n                            }`}\n                            style={{ overflow: 'visible', position: 'relative' }}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              ensureDraftsInitialized(index);\n                              setSelectedFieldIndex(index);\n                              setHoveredFieldIndex(index);\n                              setSelectedEditKey('access');\n                              setActiveCell({ rowIndex: index, key: 'access' });\n                            }}\n                          >\n                            <div className=\"flex items-center h-10\">\n                              <VSCodeDropdown\n                                data-edit-key=\"access\"\n                                value={field.access ?? 'read-write'}\n                                className=\"w-full\"\n                                position=\"below\"\n                                onFocus={() => {\n                                  setSelectedFieldIndex(index);\n                                  setHoveredFieldIndex(index);\n                                  setSelectedEditKey('access');\n                                  setActiveCell({ rowIndex: index, key: 'access' });\n                                }}\n                                onInput={(e: Event | React.FormEvent<HTMLElement>) =>\n                                  onUpdate(\n                                    ['fields', index, 'access'],\n                                    (e.target as HTMLInputElement).value\n                                  )\n                                }\n                              >\n                                {ACCESS_OPTIONS.map((opt) => (\n                                  <VSCodeOption key={opt} value={opt}>\n                                    {opt}\n                                  </VSCodeOption>\n                                ))}\n                              </VSCodeDropdown>\n                            </div>\n                          </td>\n\n                          {/* RESET */}\n                          <td\n                            data-col-key=\"reset\"\n                            className={`px-4 py-2 font-mono vscode-muted align-middle ${\n                              activeCell.rowIndex === index && activeCell.key === 'reset'\n                                ? 'vscode-cell-active'\n                                : ''\n                            }`}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              ensureDraftsInitialized(index);\n                              setSelectedFieldIndex(index);\n                              setHoveredFieldIndex(index);\n                              setSelectedEditKey('reset');\n                              setActiveCell({ rowIndex: index, key: 'reset' });\n                            }}\n                          >\n                            <div className=\"flex flex-col justify-center h-10\">\n                              <VSCodeTextField\n                                data-edit-key=\"reset\"\n                                className=\"w-full font-mono\"\n                                value={resetValue}\n                                onFocus={() => {\n                                  ensureDraftsInitialized(index);\n                                  setSelectedFieldIndex(index);\n                                  setHoveredFieldIndex(index);\n                                  setSelectedEditKey('reset');\n                                  setActiveCell({ rowIndex: index, key: 'reset' });\n                                }}\n                                onInput={(e: Event | React.FormEvent<HTMLElement>) => {\n                                  const raw = String((e.target as HTMLInputElement).value ?? '');\n                                  setResetDrafts((prev) => ({\n                                    ...prev,\n                                    [index]: raw,\n                                  }));\n                                  const trimmed = raw.trim();\n                                  if (!trimmed) {\n                                    setResetErrors((prev) => ({\n                                      ...prev,\n                                      [index]: null,\n                                    }));\n                                    onUpdate(['fields', index, 'reset_value'], null);\n                                    return;\n                                  }\n                                  const parsed = parseReset(raw);\n                                  const err = validateResetForField(field, parsed);\n                                  setResetErrors((prev) => ({\n                                    ...prev,\n                                    [index]: err,\n                                  }));\n                                  if (!err && parsed !== null) {\n                                    onUpdate(['fields', index, 'reset_value'], parsed);\n                                  }\n                                }}\n                              />\n                              {resetErr ? (\n                                <div className=\"text-xs vscode-error mt-1\">{resetErr}</div>\n                              ) : null}\n                            </div>\n                          </td>\n\n                          {/* DESCRIPTION */}\n                          <td\n                            data-col-key=\"description\"\n                            className={`px-6 py-2 vscode-muted align-middle ${\n                              activeCell.rowIndex === index && activeCell.key === 'description'\n                                ? 'vscode-cell-active'\n                                : ''\n                            }`}\n                            style={{ width: '40%', minWidth: '240px' }}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              ensureDraftsInitialized(index);\n                              setSelectedFieldIndex(index);\n                              setHoveredFieldIndex(index);\n                              setSelectedEditKey('description');\n                              setActiveCell({ rowIndex: index, key: 'description' });\n                            }}\n                          >\n                            <div className=\"flex items-center h-10\">\n                              <VSCodeTextArea\n                                data-edit-key=\"description\"\n                                className=\"w-full\"\n                                style={{\n                                  height: '40px',\n                                  minHeight: '40px',\n                                  resize: 'none',\n                                }}\n                                rows={1}\n                                value={field.description ?? ''}\n                                onFocus={() => {\n                                  setSelectedFieldIndex(index);\n                                  setHoveredFieldIndex(index);\n                                  setSelectedEditKey('description');\n                                  setActiveCell({\n                                    rowIndex: index,\n                                    key: 'description',\n                                  });\n                                }}\n                                onInput={(e: Event | React.FormEvent<HTMLElement>) =>\n                                  onUpdate(\n                                    ['fields', index, 'description'],\n                                    (e.target as HTMLInputElement).value\n                                  )\n                                }\n                              />\n                            </div>\n                          </td>\n                        </>\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </>\n            )}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/components/register/RegisterEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/hooks/useFieldEditor.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .blur on an `any` value.","line":418,"column":9,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":418,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":418,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":418,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14380,14383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14380,14383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useRef, useState } from 'react';\nimport { SpatialInsertionService } from '../services/SpatialInsertionService';\nimport type { BitFieldRuntimeDef } from '../services/SpatialInsertionService';\nimport { fieldToBitsString } from '../utils/BitFieldUtils';\nimport type { BitFieldRecord, YamlUpdateHandler } from '../types/editor';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type EditKey = 'name' | 'bits' | 'access' | 'reset' | 'description';\nexport type ActiveCell = { rowIndex: number; key: EditKey };\n\nexport const COLUMN_ORDER: EditKey[] = ['name', 'bits', 'access', 'reset', 'description'];\n\n// ---------------------------------------------------------------------------\n// Hook\n// ---------------------------------------------------------------------------\n\n/**\n * Manages editing state and operations for bit fields within a register.\n * Handles draft values, validation errors, active cell tracking,\n * and spatial insertion logic.\n *\n * @param fields   Normalised bit field array for the current register.\n * @param registerSize  Register width in bits (e.g. 32).\n * @param onUpdate Callback to commit a YAML path + value change.\n * @param isActive When false the keyboard handler is not installed.\n */\nexport function useFieldEditor(\n  fields: BitFieldRecord[],\n  registerSize: number,\n  onUpdate: YamlUpdateHandler,\n  isActive = true\n) {\n  // ---- selection / hover ----\n  const [selectedFieldIndex, setSelectedFieldIndex] = useState<number>(-1);\n  const [hoveredFieldIndex, setHoveredFieldIndex] = useState<number | null>(null);\n  const [selectedEditKey, setSelectedEditKey] = useState<EditKey>('name');\n  const [activeCell, setActiveCell] = useState<ActiveCell>({\n    rowIndex: -1,\n    key: 'name',\n  });\n\n  // ---- drafts ----\n  const [nameDrafts, setNameDrafts] = useState<Record<string, string>>({});\n  const [nameErrors, setNameErrors] = useState<Record<string, string | null>>({});\n  const [bitsDrafts, setBitsDrafts] = useState<Record<number, string>>({});\n  const [bitsErrors, setBitsErrors] = useState<Record<number, string | null>>({});\n  const [dragPreviewRanges, setDragPreviewRanges] = useState<Record<number, [number, number]>>({});\n  const [resetDrafts, setResetDrafts] = useState<Record<number, string>>({});\n  const [resetErrors, setResetErrors] = useState<Record<number, string | null>>({});\n\n  // ---- insert error ----\n  const [insertError, setInsertError] = useState<string | null>(null);\n\n  // ---- DOM refs ----\n  const focusRef = useRef<HTMLDivElement | null>(null);\n  const errorRef = useRef<HTMLDivElement | null>(null);\n\n  // ---------------------------------------------------------------------------\n  // Internal helpers\n  // ---------------------------------------------------------------------------\n\n  const refocusTableSoon = useCallback(() => {\n    window.setTimeout(() => {\n      focusRef.current?.focus();\n    }, 0);\n  }, []);\n\n  const focusFieldEditor = useCallback((rowIndex: number, key: EditKey) => {\n    window.setTimeout(() => {\n      const row = document.querySelector(`tr[data-field-index=\"${rowIndex}\"]`);\n      const el = row?.querySelector(`[data-edit-key=\"${key}\"]`) as HTMLElement | null;\n      try {\n        el?.focus();\n      } catch {\n        // ignore\n      }\n    }, 0);\n  }, []);\n\n  // ---------------------------------------------------------------------------\n  // Public helpers returned to consumers\n  // ---------------------------------------------------------------------------\n\n  /** Initialises drafts for row `index` if they haven't been set yet. */\n  const ensureDraftsInitialized = useCallback(\n    (index: number) => {\n      const field = fields[index];\n      if (!field) {\n        return;\n      }\n      const key = field.name ? `${field.name}` : `idx-${index}`;\n      setNameDrafts((prev) =>\n        prev[key] !== undefined ? prev : { ...prev, [key]: String(field.name ?? '') }\n      );\n      setBitsDrafts((prev) =>\n        prev[index] !== undefined ? prev : { ...prev, [index]: fieldToBitsString(field) }\n      );\n      setResetDrafts((prev) => {\n        if (prev[index] !== undefined) {\n          return prev;\n        }\n        const v = field?.reset_value;\n        const display =\n          v !== null && v !== undefined ? `0x${Number(v).toString(16).toUpperCase()}` : '0x0';\n        return { ...prev, [index]: display };\n      });\n    },\n    [fields]\n  );\n\n  /** Moves the currently selected field up (-1) or down (+1). */\n  const moveSelectedField = useCallback(\n    (delta: -1 | 1) => {\n      const index = selectedFieldIndex;\n      if (index < 0) {\n        return;\n      }\n      const next = index + delta;\n      if (next < 0 || next >= fields.length) {\n        return;\n      }\n      onUpdate(['__op', 'field-move'], { index, delta });\n      setBitsDrafts({});\n      setBitsErrors({});\n      setNameDrafts({});\n      setNameErrors({});\n      setSelectedFieldIndex(next);\n      setHoveredFieldIndex(next);\n    },\n    [selectedFieldIndex, fields.length, onUpdate]\n  );\n\n  // ---------------------------------------------------------------------------\n  // Clamp selection when the register changes\n  // ---------------------------------------------------------------------------\n  useEffect(() => {\n    if (!isActive) {\n      setSelectedFieldIndex(-1);\n      setActiveCell({ rowIndex: -1, key: 'name' });\n      return;\n    }\n    if (!fields.length) {\n      setSelectedFieldIndex(-1);\n      setActiveCell({ rowIndex: -1, key: 'name' });\n      return;\n    }\n    setSelectedFieldIndex((prev) => {\n      if (prev < 0) {\n        return 0;\n      }\n      if (prev >= fields.length) {\n        return fields.length - 1;\n      }\n      return prev;\n    });\n    setActiveCell((prev) => {\n      const rowIndex = prev.rowIndex < 0 ? 0 : Math.min(fields.length - 1, prev.rowIndex);\n      const key = COLUMN_ORDER.includes(prev.key) ? prev.key : 'name';\n      return { rowIndex, key };\n    });\n  }, [isActive, fields.length]);\n\n  // ---------------------------------------------------------------------------\n  // Keyboard shortcuts (o/O insert, arrow nav, F2/e edit, d delete)\n  // ---------------------------------------------------------------------------\n  useEffect(() => {\n    if (!isActive) {\n      return;\n    }\n\n    const tryInsertField = (after: boolean) => {\n      setInsertError(null);\n      // BitFieldRecord is structurally compatible with BitFieldRuntimeDef at runtime\n      const typedFields = fields as unknown as BitFieldRuntimeDef[];\n      const result = after\n        ? SpatialInsertionService.insertFieldAfter(typedFields, selectedFieldIndex, registerSize)\n        : SpatialInsertionService.insertFieldBefore(typedFields, selectedFieldIndex, registerSize);\n\n      if (result.error) {\n        setInsertError(result.error);\n        window.setTimeout(\n          () =>\n            errorRef.current?.scrollIntoView({\n              block: 'nearest',\n              behavior: 'smooth',\n            }),\n          0\n        );\n        return;\n      }\n\n      const newIndex = result.newIndex;\n      onUpdate(['fields'], result.items);\n      setSelectedFieldIndex(newIndex);\n      setHoveredFieldIndex(newIndex);\n      setActiveCell({ rowIndex: newIndex, key: 'name' });\n      setBitsDrafts({});\n      setBitsErrors({});\n      setNameDrafts({});\n      setNameErrors({});\n      window.setTimeout(() => {\n        document\n          .querySelector(`tr[data-field-index=\"${newIndex}\"]`)\n          ?.scrollIntoView({ block: 'center' });\n      }, 100);\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      let keyLower = (e.key || '').toLowerCase();\n      if (e.altKey && e.code) {\n        if (e.code === 'KeyH') {\n          keyLower = 'h';\n        }\n        if (e.code === 'KeyJ') {\n          keyLower = 'j';\n        }\n        if (e.code === 'KeyK') {\n          keyLower = 'k';\n        }\n        if (e.code === 'KeyL') {\n          keyLower = 'l';\n        }\n      }\n      const vimToArrow: Record<string, 'ArrowLeft' | 'ArrowDown' | 'ArrowUp' | 'ArrowRight'> = {\n        h: 'ArrowLeft',\n        j: 'ArrowDown',\n        k: 'ArrowUp',\n        l: 'ArrowRight',\n      };\n      const mappedArrow = vimToArrow[keyLower];\n      const normalizedKey: string = mappedArrow ?? e.key;\n\n      const isArrow =\n        normalizedKey === 'ArrowUp' ||\n        normalizedKey === 'ArrowDown' ||\n        normalizedKey === 'ArrowLeft' ||\n        normalizedKey === 'ArrowRight';\n      const isEdit = normalizedKey === 'F2' || keyLower === 'e';\n      const isDelete = keyLower === 'd' || e.key === 'Delete';\n      const isInsertAfter = keyLower === 'o' && !e.shiftKey;\n      const isInsertBefore = keyLower === 'o' && e.shiftKey;\n\n      if (!isArrow && !isEdit && !isDelete && !isInsertAfter && !isInsertBefore) {\n        return;\n      }\n      if (e.ctrlKey || e.metaKey) {\n        return;\n      }\n\n      const activeEl = document.activeElement as HTMLElement | null;\n      const isInFieldsArea =\n        !!focusRef.current &&\n        !!activeEl &&\n        (activeEl === focusRef.current || focusRef.current.contains(activeEl));\n      if (!isInFieldsArea) {\n        return;\n      }\n\n      const target = e.target as HTMLElement | null;\n      const isInDropdown = !!target?.closest('vscode-dropdown');\n      const isTypingTarget = !!target?.closest(\n        'input, textarea, select, [contenteditable=\"true\"], vscode-text-field, vscode-text-area'\n      );\n      if (isTypingTarget) {\n        return;\n      }\n      if (isInDropdown && !keyLower.match(/^[hjkl]$/)) {\n        return;\n      }\n\n      const scrollToCell = (rowIndex: number, key: EditKey) => {\n        window.setTimeout(() => {\n          const row = document.querySelector(`tr[data-field-index=\"${rowIndex}\"]`);\n          row?.scrollIntoView({\n            block: rowIndex === 0 ? 'center' : 'nearest',\n          });\n          const cell = row?.querySelector(`td[data-col-key=\"${key}\"]`) as HTMLElement | null;\n          cell?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n        }, 0);\n      };\n\n      const currentRow =\n        activeCell.rowIndex >= 0\n          ? activeCell.rowIndex\n          : selectedFieldIndex >= 0\n            ? selectedFieldIndex\n            : 0;\n      const currentKey: EditKey = COLUMN_ORDER.includes(activeCell.key)\n        ? activeCell.key\n        : selectedEditKey;\n\n      if (isEdit) {\n        if (currentRow < 0 || currentRow >= fields.length) {\n          return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        setSelectedFieldIndex(currentRow);\n        setHoveredFieldIndex(currentRow);\n        setSelectedEditKey(currentKey);\n        setActiveCell({ rowIndex: currentRow, key: currentKey });\n        focusFieldEditor(currentRow, currentKey);\n        return;\n      }\n\n      if (isInsertAfter || isInsertBefore) {\n        e.preventDefault();\n        e.stopPropagation();\n        tryInsertField(isInsertAfter);\n        return;\n      }\n\n      if (isDelete) {\n        if (currentRow < 0 || currentRow >= fields.length) {\n          return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        const newFields = fields.filter((_, index) => index !== currentRow);\n        onUpdate(['fields'], newFields);\n        const nextRow = currentRow > 0 ? currentRow - 1 : newFields.length > 0 ? 0 : -1;\n        setSelectedFieldIndex(nextRow);\n        setHoveredFieldIndex(nextRow);\n        setActiveCell({ rowIndex: nextRow, key: currentKey });\n        setBitsDrafts({});\n        setBitsErrors({});\n        setNameDrafts({});\n        setNameErrors({});\n        return;\n      }\n\n      const isVertical = normalizedKey === 'ArrowUp' || normalizedKey === 'ArrowDown';\n      const delta = normalizedKey === 'ArrowUp' || normalizedKey === 'ArrowLeft' ? -1 : 1;\n\n      if (e.altKey && isVertical) {\n        if (selectedFieldIndex < 0) {\n          return;\n        }\n        const next = selectedFieldIndex + delta;\n        if (next < 0 || next >= fields.length) {\n          return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        onUpdate(['__op', 'field-move'], { index: selectedFieldIndex, delta });\n        setBitsDrafts({});\n        setBitsErrors({});\n        setNameDrafts({});\n        setNameErrors({});\n        setSelectedFieldIndex(next);\n        setHoveredFieldIndex(next);\n        setActiveCell((prev) => ({ rowIndex: next, key: prev.key }));\n        scrollToCell(next, currentKey);\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (isVertical) {\n        const nextRow = Math.max(0, Math.min(fields.length - 1, currentRow + delta));\n        setSelectedFieldIndex(nextRow);\n        setHoveredFieldIndex(nextRow);\n        setSelectedEditKey(currentKey);\n        setActiveCell({ rowIndex: nextRow, key: currentKey });\n        scrollToCell(nextRow, currentKey);\n        return;\n      }\n\n      const currentCol = Math.max(0, COLUMN_ORDER.indexOf(currentKey));\n      const nextCol = Math.max(0, Math.min(COLUMN_ORDER.length - 1, currentCol + delta));\n      const nextKey = COLUMN_ORDER[nextCol] ?? 'name';\n      setSelectedFieldIndex(currentRow);\n      setHoveredFieldIndex(currentRow);\n      setSelectedEditKey(nextKey);\n      setActiveCell({ rowIndex: currentRow, key: nextKey });\n      scrollToCell(currentRow, nextKey);\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [\n    isActive,\n    fields.length,\n    selectedFieldIndex,\n    selectedEditKey,\n    activeCell,\n    onUpdate,\n    registerSize,\n  ]);\n\n  // ---------------------------------------------------------------------------\n  // Escape: return focus from inline editor back to the table container\n  // ---------------------------------------------------------------------------\n  useEffect(() => {\n    if (!isActive) {\n      return;\n    }\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'Escape') {\n        return;\n      }\n      const activeEl = document.activeElement as HTMLElement | null;\n      if (!activeEl) {\n        return;\n      }\n      const inFields =\n        !!focusRef.current && focusRef.current.contains(activeEl) && activeEl !== focusRef.current;\n      if (!inFields) {\n        return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n      try {\n        (activeEl as any).blur?.();\n      } catch {\n        // ignore\n      }\n      refocusTableSoon();\n    };\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [isActive, refocusTableSoon]);\n\n  return {\n    // selection / hover\n    selectedFieldIndex,\n    setSelectedFieldIndex,\n    hoveredFieldIndex,\n    setHoveredFieldIndex,\n    selectedEditKey,\n    setSelectedEditKey,\n    activeCell,\n    setActiveCell,\n    // drafts\n    nameDrafts,\n    setNameDrafts,\n    nameErrors,\n    setNameErrors,\n    bitsDrafts,\n    setBitsDrafts,\n    bitsErrors,\n    setBitsErrors,\n    dragPreviewRanges,\n    setDragPreviewRanges,\n    resetDrafts,\n    setResetDrafts,\n    resetErrors,\n    setResetErrors,\n    // insert error\n    insertError,\n    setInsertError,\n    // refs\n    focusRef,\n    errorRef,\n    // helpers\n    ensureDraftsInitialized,\n    moveSelectedField,\n    focusFieldEditor,\n    refocusTableSoon,\n  };\n}\n\n/** Return type of {@link useFieldEditor}. */\nexport type FieldEditorState = ReturnType<typeof useFieldEditor>;\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/hooks/useMemoryMapState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/hooks/useSelection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/hooks/useTableNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/hooks/useYamlSync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/IpCoreApp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/layout/EditorPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/layout/NavigationSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/BusInterfacesEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/ClocksTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/FileSetsEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/GeneratorPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/MemoryMapsEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/MetadataEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/ParametersTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/PortsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/components/sections/ResetsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/hooks/useIpCoreState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/hooks/useIpCoreSync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/hooks/useNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/ipcore/hooks/useVimTableNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/services/DataNormalizer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/services/SpatialInsertionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/services/YamlPathResolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/services/YamlService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/colors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/CheckboxField.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[725,728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[725,728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `boolean`.","line":29,"column":38,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":29,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .target on an `any` value.","line":29,"column":38,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":29,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { VSCodeCheckbox } from '@vscode/webview-ui-toolkit/react';\n\nexport interface CheckboxFieldProps {\n  label: string;\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  disabled?: boolean;\n  /** Additional data attribute for edit key (vim navigation) */\n  'data-edit-key'?: string;\n}\n\n/**\n * Checkbox field for boolean values\n * Uses VSCode Web UI Toolkit for native VS Code look and feel\n */\nexport const CheckboxField: React.FC<CheckboxFieldProps> = ({\n  label,\n  checked,\n  onChange,\n  disabled = false,\n  'data-edit-key': dataEditKey,\n}) => {\n  return (\n    <VSCodeCheckbox\n      data-edit-key={dataEditKey}\n      checked={checked}\n      disabled={disabled}\n      onChange={(e: any) => onChange(e.target.checked)}\n    >\n      {label}\n    </VSCodeCheckbox>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/EditableTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/FormField.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1307,1310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1307,1310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2302,2305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2302,2305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/KeyboardShortcutsButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/NumberField.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .key on an `any` value.","line":51,"column":9,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":51,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .key on an `any` value.","line":53,"column":16,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":53,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1677,1680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1677,1680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":71,"column":43,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":71,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .target on an `any` value.","line":71,"column":43,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":71,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { VSCodeTextField } from '@vscode/webview-ui-toolkit/react';\n\nexport interface NumberFieldProps {\n  label: string;\n  value: number;\n  onChange: (value: number) => void;\n  min?: number;\n  max?: number;\n  step?: number;\n  error?: string;\n  required?: boolean;\n  disabled?: boolean;\n  /** Additional data attribute for edit key (vim navigation) */\n  'data-edit-key'?: string;\n  /** Additional className for the text field */\n  className?: string;\n  onSave?: () => void;\n  onCancel?: () => void;\n}\n\n/**\n * Numeric input field\n * Uses VSCode Web UI Toolkit for native VS Code look and feel\n */\nexport const NumberField: React.FC<NumberFieldProps> = ({\n  label,\n  value,\n  onChange,\n  min: _min,\n  max: _max,\n  step: _step = 1,\n  error,\n  required = false,\n  disabled = false,\n  'data-edit-key': dataEditKey,\n  className,\n  onSave,\n  onCancel,\n}) => {\n  const handleChange = (newValue: string) => {\n    const num = parseInt(newValue, 10);\n    if (!isNaN(num)) {\n      onChange(num);\n    } else if (newValue === '') {\n      onChange(0);\n    }\n  };\n\n  const handleKeyDown = (e: any) => {\n    if (e.key === 'Enter') {\n      onSave?.();\n    } else if (e.key === 'Escape') {\n      onCancel?.();\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-1\">\n      {label && (\n        <label className=\"text-sm font-semibold flex items-center gap-1\">\n          {label}\n          {required && <span style={{ color: 'var(--vscode-errorForeground)' }}>*</span>}\n        </label>\n      )}\n      <VSCodeTextField\n        data-edit-key={dataEditKey}\n        className={className}\n        value={String(value)}\n        disabled={disabled}\n        onInput={(e: any) => handleChange(e.target.value ?? '')}\n        onKeyDown={handleKeyDown}\n        style={\n          {\n            '--input-border-color': error ? 'var(--vscode-inputValidation-errorBorder)' : undefined,\n          } as React.CSSProperties\n        }\n      />\n      {error && (\n        <span className=\"text-xs\" style={{ color: 'var(--vscode-errorForeground)' }}>\n          {error}\n        </span>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/ReferenceField.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/SelectField.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .key on an `any` value.","line":38,"column":9,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":38,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .key on an `any` value.","line":40,"column":16,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":40,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1455,1458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1455,1458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":58,"column":40,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":58,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .target on an `any` value.","line":58,"column":40,"nodeType":"MemberExpression","messageId":"unsafeMemberExpression","endLine":58,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { VSCodeDropdown, VSCodeOption } from '@vscode/webview-ui-toolkit/react';\n\nexport interface SelectFieldProps {\n  label: string;\n  value: string;\n  options: Array<{ value: string; label: string }>;\n  onChange: (value: string) => void;\n  error?: string;\n  required?: boolean;\n  disabled?: boolean;\n  /** Additional data attribute for edit key (vim navigation) */\n  'data-edit-key'?: string;\n  /** Additional className for the dropdown */\n  className?: string;\n  onSave?: () => void;\n  onCancel?: () => void;\n}\n\n/**\n * Dropdown select field\n * Uses VSCode Web UI Toolkit for native VS Code look and feel\n */\nexport const SelectField: React.FC<SelectFieldProps> = ({\n  label,\n  value,\n  options,\n  onChange,\n  error,\n  required = false,\n  disabled = false,\n  'data-edit-key': dataEditKey,\n  className,\n  onSave,\n  onCancel,\n}) => {\n  const handleKeyDown = (e: any) => {\n    if (e.key === 'Enter') {\n      onSave?.();\n    } else if (e.key === 'Escape') {\n      onCancel?.();\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-1\">\n      {label && (\n        <label className=\"text-sm font-semibold flex items-center gap-1\">\n          {label}\n          {required && <span style={{ color: 'var(--vscode-errorForeground)' }}>*</span>}\n        </label>\n      )}\n      <VSCodeDropdown\n        data-edit-key={dataEditKey}\n        className={className}\n        value={value}\n        disabled={disabled}\n        onChange={(e: any) => onChange(e.target.value)}\n        onKeyDown={handleKeyDown}\n        style={\n          {\n            '--dropdown-border': error\n              ? '1px solid var(--vscode-inputValidation-errorBorder)'\n              : undefined,\n          } as React.CSSProperties\n        }\n      >\n        {options.map((option) => (\n          <VSCodeOption key={option.value} value={option.value}>\n            {option.label}\n          </VSCodeOption>\n        ))}\n      </VSCodeDropdown>\n      {error && (\n        <span className=\"text-xs\" style={{ color: 'var(--vscode-errorForeground)' }}>\n          {error}\n        </span>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/TextAreaField.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[958,961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[958,961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1740,1743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1740,1743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/utils/validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/shared/utils/yamlKeyMapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/types/editor.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/types/ipCore.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/types/memoryMap.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/types/selection.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/utils/BitFieldUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/balevision/workspace/bleviet/ipcraft-vscode/src/webview/vscode.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
